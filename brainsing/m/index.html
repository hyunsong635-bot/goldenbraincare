<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"/>
<title>ë¸Œë ˆì¸ ë…¸ë˜ë°© MOBILE - AI ë‡Œì‹ ê²½ ì¼€ì–´</title>
<link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;700&family=Noto+Sans+KR:wght@300;400;500;700;900&display=swap" rel="stylesheet">
<style>
:root{
  --bg: #fffbf0; /* ìƒ´í˜ì¸ í¬ë¦¼ ë°°ê²½ */
  --card: #ffffff;
  --header-bg: #ffffff;
  --gold: #9b6a1f;
  --gold-light: #c48a2c;
  --gold-pale: #fdf6e3;
  --text-main: #2b1a0f;
  --text-dim: #7f6d5f;
  --accent: #e11d48;
  --success: #10b981;
  --border: #f1e6d0;
}

*{box-sizing:border-box; -webkit-tap-highlight-color: transparent; -webkit-print-color-adjust: exact;}
body{
  margin:0;
  font-family: "Noto Sans KR", sans-serif;
  background-color: var(--bg);
  color: var(--text-main);
  height: 100vh;
  display: flex;
  flex-direction: column;
  overflow: hidden;
}

/* MOBILE HEADER */
header{
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 12px 15px;
  background: var(--header-bg);
  border-bottom: 2.5px solid var(--gold-light);
  box-shadow: 0 4px 12px rgba(155, 106, 31, 0.08);
  z-index: 50;
  flex-shrink: 0;
}
header h1{ margin:0; font-size: 18px; font-weight: 900; color: var(--gold); letter-spacing: -0.5px; }
header .sys-info { font-family: 'JetBrains Mono'; font-size: 8px; color: var(--text-dim); }

/* MAIN CONTENT */
main{
  flex-grow: 1;
  display: flex;
  flex-direction: column;
  padding: 12px;
  gap: 12px;
  overflow-y: auto;
}

.card{
  background: var(--card);
  border-radius: 20px;
  border: 1px solid var(--border);
  position: relative;
  overflow: hidden;
  display: flex;
  flex-direction: column;
  box-shadow: 0 6px 20px rgba(155, 106, 31, 0.05);
}

/* ENGINE STAGE (CAMERA) */
.engine-container {
  flex-shrink: 0;
  aspect-ratio: 1/1; /* ëª¨ë°”ì¼ì—ì„œ ë” ì§‘ì¤‘ë„ ë†’ì€ 1:1 ë¹„ìœ¨ */
  background: #000;
  position: relative;
  border-radius: 20px;
  overflow: hidden;
}
video { width: 100%; height: 100%; object-fit: cover; transform: scaleX(-1); opacity: 0.9; }

.scan-line {
  position: absolute; width: 100%; height: 3px; background: #fff;
  top: 0; left: 0; box-shadow: 0 0 20px var(--gold-light);
  animation: scan 4s linear infinite; z-index: 5;
}
@keyframes scan { from{top:0%} to{top:100%} }

.hud-timer {
  position: absolute; top: 15px; right: 15px; font-family: 'JetBrains Mono';
  font-size: 32px; color: #fff; font-weight: 700; z-index: 20;
  text-shadow: 0 0 10px rgba(0,0,0,0.8);
}

/* LYRICS SECTION */
.lyric-card {
  padding: 25px 15px;
  text-align: center;
  border-top: 4px solid var(--gold-light);
  min-height: 100px;
  display: flex;
  align-items: center;
  justify-content: center;
}
.lyric-text { font-size: 26px; font-weight: 900; color: #f0ede4; position: relative; white-space: nowrap; letter-spacing: -1px; }
.lyric-fill {
  position: absolute; left: 0; top: 0; width: 0%; height: 100%;
  color: var(--gold); overflow: hidden; white-space: nowrap;
  transition: width 0.1s linear;
}

/* VITAL STATS AREA */
.stats-grid {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 10px;
}
.data-box { padding: 15px; background: var(--gold-pale); border-radius: 15px; border: 1px solid var(--border); border-left: 5px solid var(--gold); }
.data-box label { display: block; font-size: 10px; color: var(--gold); margin-bottom: 4px; font-weight: 800; text-transform: uppercase; }
.data-box .val { font-family: 'JetBrains Mono'; font-size: 22px; font-weight: 800; color: var(--text-main); }

/* OVERLAYS */
.full-overlay {
  position: absolute; inset: 0; background: rgba(255, 251, 240, 0.99);
  display: flex; flex-direction: column; align-items: center; justify-content: center; z-index: 100;
  text-align: center; padding: 30px;
}

.btn {
  padding: 16px 35px; border-radius: 14px; border: 2.5px solid var(--gold);
  background: white; color: var(--gold); font-weight: 900; cursor: pointer;
  transition: all 0.2s; font-size: 16px; width: 100%; max-width: 300px;
  box-shadow: 0 4px 10px rgba(0,0,0,0.05);
}
.btn:active { transform: scale(0.97); background: var(--gold-pale); }

/* RANKING */
.rank-item {
  display: flex; justify-content: space-between; padding: 12px;
  background: #ffffff; border-radius: 10px; margin-bottom: 6px;
  font-weight: 700; border: 1px solid var(--border); font-size: 13px;
}
.rank-item.top { background: var(--gold-pale); border-color: var(--gold); }

/* INPUTS */
input, select { padding: 14px; border-radius: 10px; border: 1.5px solid var(--border); font-size: 16px; width: 100%; background: #fff; margin-bottom: 12px; }

/* BRANDING FOOTER */
.sidebar-footer {
  margin-top: auto; padding: 15px 0; text-align: center;
}
.brand-name { font-size: 22px; font-weight: 900; color: var(--gold); margin-bottom: 8px; display: block; }
.side-warning { padding: 12px; background: #fff1f2; border-radius: 12px; border: 1.5px solid #fecdd3; font-size: 11px; color: #be123c; font-weight: 700; line-height: 1.5; }

</style>
</head>
<body>

<header>
  <div>
    <h1>ë¸Œë ˆì¸ ë…¸ë˜ë°© <span style="font-weight:300; font-size:14px;">|</span> <span id="header-user" style="font-size:14px;">ì¤€ë¹„</span></h1>
    <div class="sys-info">NEURAL ENGINE v5.3.0M</div>
  </div>
  <div style="background:var(--accent); color:white; padding:4px 10px; border-radius:6px; font-weight:900; font-size:10px;">PREMIUM</div>
</header>

<main>
  <!-- Scanning Card -->
  <div class="card" style="flex-grow:1;">
    <div class="engine-container" id="engine-stage">
      <!-- 1. Regist Overlay -->
      <div id="intro-overlay" class="full-overlay">
        <h2 style="font-size:28px; color:var(--gold); margin-bottom:10px;">ë¸Œë ˆì¸ ë…¸ë˜ë°©</h2>
        <p style="color:var(--text-dim); margin-bottom:25px; font-size:15px;">ë…¸ë˜ë¡œ ë¶„ì„í•˜ëŠ” ë‚˜ì˜ ë‡Œ ê±´ê°•</p>
        <div style="width:100%; max-width:300px;">
          <input type="text" id="p-name" placeholder="ì„±í•¨">
          <input type="number" id="p-age" placeholder="ë‚˜ì´">
          <select id="p-gender">
            <option value="ë‚¨ì„±">ì„±ë³„: ë‚¨ì„±</option>
            <option value="ì—¬ì„±">ì„±ë³„: ì—¬ì„±</option>
          </select>
          <button class="btn" onclick="register()">ë“±ë¡ ë° ì‹œë‚˜ë¦¬ì˜¤ ì„ íƒ</button>
        </div>
      </div>

      <!-- 2. Select Overlay -->
      <div id="select-overlay" class="full-overlay" style="display:none;">
        <h2 style="font-size:22px; color:var(--gold);">ê³¡ ì„ íƒ</h2>
        <div style="display:grid; gap:12px; width:100%; max-width:300px;">
          <button class="btn" onclick="prepare('ì•„ë¦¬ë‘', 1)">LV.1 ì•„ë¦¬ë‘</button>
          <button class="btn" onclick="prepare('ì• êµ­ê°€', 1)">LV.1 ì• êµ­ê°€</button>
          <button class="btn" onclick="prepare('ë‚´ ë‚˜ì´ê°€ ì–´ë•Œì„œ', 2)">LV.2 ë‚´ ë‚˜ì´ê°€ ì–´ë•Œì„œ</button>
          <button class="btn" onclick="prepare('ë¬´ì¡°ê±´', 3)">LV.3 ë¬´ì¡°ê±´</button>
        </div>
      </div>

      <!-- 3. Guide Overlay -->
      <div id="guide-overlay" class="full-overlay" style="display:none;">
        <div style="background:white; border:4px solid var(--gold); padding:25px; border-radius:24px; width:90%; box-shadow: 0 15px 40px rgba(155, 106, 31, 0.2);">
          <h3 style="margin:0; font-size:24px;">ê°€ì°½ ê°€ì´ë“œ</h3>
          <p style="font-size:20px; color:var(--accent); font-weight:900; margin:15px 0;">"ì…ì„ ì•„ì£¼ í¬ê²Œ ë²Œë¦¬ê³  ë¶ˆëŸ¬ì£¼ì„¸ìš”!"</p>
          <p style="font-size:14px; color:var(--text-dim);">ì •ë°€í•œ ì‹ ê²½ í˜‘ì‘ ë¶„ì„ì„ ìœ„í•´ í•„ìˆ˜ì ì¸ ê³¼ì •ì…ë‹ˆë‹¤.</p>
          <button class="btn" style="margin-top:20px;" onclick="startCountdown()">í™•ì¸ ë° ì‹œì‘</button>
        </div>
      </div>

      <!-- 4. Countdown Overlay -->
      <div id="countdown-overlay" class="full-overlay" style="display:none; background:rgba(255,251,240,0.95);">
        <div id="countdown-num" style="font-size:120px; font-weight:900; color:var(--gold);">3</div>
      </div>

      <div class="hud-timer" id="hud-timer">30.0</div>
      <div class="scan-line" id="scanner" style="display:none;"></div>
      <video id="webcam" autoplay playsinline></video>
    </div>

    <!-- Lyrics -->
    <div class="lyric-card">
      <div class="lyric-text">
        <span id="lyric-base">ì‹œìŠ¤í…œ ì¤€ë¹„ ì™„ë£Œ</span>
        <div class="lyric-fill" id="lyric-fill">ì‹œìŠ¤í…œ ì¤€ë¹„ ì™„ë£Œ</div>
      </div>
    </div>
  </div>

  <!-- Realtime Stats -->
  <div class="stats-grid">
    <div class="data-box">
      <label>ì„±ëŒ€ ì•ˆì •ì„±</label>
      <div class="val" id="rt-jitter">0.00%</div>
    </div>
    <div class="data-box">
      <label>ì•ˆë©´ ëŒ€ì¹­</label>
      <div class="val" id="rt-si">00.0</div>
    </div>
  </div>

  <!-- Mobile Footer -->
  <div class="sidebar-footer">
    <span class="brand-name">ê³¨ë“ ë¸Œë ˆì¸ì¼€ì–´</span>
    <div class="side-warning">
      âš ï¸ ì¤‘ìš”: ë¸Œë ˆì¸ ë…¸ë˜ë°©ì€ AI ê°„ì´ ì„ ë³„ ë„êµ¬ì…ë‹ˆë‹¤. ì˜í•™ì  ì§„ë‹¨ì„ ëŒ€ì‹ í•  ìˆ˜ ì—†ìœ¼ë©°, ì´ìƒ ì‹œ ì „ë¬¸ ì˜ë£Œê¸°ê´€ì„ ë°©ë¬¸í•˜ì‹­ì‹œì˜¤.
    </div>
  </div>
</main>

<!-- RESULT PAGE (Mobile Adaptive) -->
<div id="result-page" class="full-overlay" style="display:none; background:#fffcf5; overflow-y:auto;">
  <div style="background:white; width:95%; padding:30px; border-radius:24px; border:2px solid var(--gold-light); margin: 25px 0; box-shadow: 0 10px 40px rgba(0,0,0,0.1);">
    <h2 style="font-size:24px; color:var(--gold); margin-top:0; border-bottom:2px solid var(--gold-light); padding-bottom:10px;">ì§„ë‹¨ ê²°ê³¼</h2>
    
    <div style="text-align:center; margin:20px 0;">
      <div style="font-size:14px; color:var(--text-dim); margin-bottom:5px;">ë‚˜ì˜ ë‡Œ ê±´ê°• ì ìˆ˜</div>
      <div style="font-size:72px; font-weight:900; color:var(--gold); line-height:1;">
        <span id="final-score">0</span>ì 
      </div>
    </div>

    <div style="margin-bottom:25px;">
      <div style="font-size:14px; font-weight:800; color:var(--gold); margin-bottom:10px;">ğŸ† ì „êµ­ ì‹¤ë²„ ë­í‚¹ (ë™ì¼ ì—°ë ¹ëŒ€)</div>
      <div id="ranking-list"></div>
    </div>

    <div id="res-comment" style="font-size:14px; line-height:1.7; background:var(--gold-pale); padding:18px; border-radius:15px; border-left:5px solid var(--gold); margin-bottom:25px; text-align:left;"></div>

    <button class="btn" style="background:var(--success); color:white; border:none; margin-bottom:10px;" onclick="downloadPDF()">ì „ë¬¸ ë¦¬í¬íŠ¸ ë‹¤ìš´ë¡œë“œ (A4)</button>
    <button class="btn" style="background:var(--gold); color:white; border:none;" onclick="location.reload()">ì²˜ìŒìœ¼ë¡œ ëŒì•„ê°€ê¸°</button>
  </div>
</div>

<script>
/**
 * BRAIN NORAEBANG MOBILE ENGINE v5.3.0
 */
const state = {
  user: null, song: null, isSinging: false, startTime: 0,
  history: { jitter: [], si: [] },
  lyrics: {
    'ì•„ë¦¬ë‘': [ {t:0, d:4, txt:"ì•„ë¦¬ë‘ ì•„ë¦¬ë‘"}, {t:4, d:4, txt:"ì•„ë¼ë¦¬ìš”~"}, {t:8, d:4, txt:"ì•„ë¦¬ë‘ ê³ ê°œë¥¼"}, {t:12, d:4, txt:"ë„˜ì–´ê°„ë‹¤~"}, {t:16, d:4, txt:"ë‚˜ë¥¼ ë²„ë¦¬ê³ "}, {t:20, d:4, txt:"ê°€ì‹œëŠ” ë‹˜ì€"}, {t:24, d:4, txt:"ì‹­ë¦¬ë„ ëª»ê°€ì„œ"}, {t:28, d:2, txt:"ë°œë³‘ë‚œë‹¤"} ],
    'ì• êµ­ê°€': [ {t:0, d:5, txt:"ë™í•´ë¬¼ê³¼ ë°±ë‘ì‚°ì´"}, {t:5, d:5, txt:"ë§ˆë¥´ê³  ë‹³ë„ë¡"}, {t:10, d:5, txt:"í•˜ëŠë‹˜ì´ ë³´ìš°í•˜ì‚¬"}, {t:15, d:5, txt:"ìš°ë¦¬ë‚˜ë¼ ë§Œì„¸"}, {t:20, d:5, txt:"ë¬´ê¶í™” ì‚¼ì²œë¦¬"}, {t:25, d:5, txt:"í™”ë ¤ê°•ì‚°"} ],
    'ë‚´ ë‚˜ì´ê°€ ì–´ë•Œì„œ': [ {t:0, d:4, txt:"ì•¼ì•¼ì•¼ ë‚´ ë‚˜ì´ê°€ ì–´ë•Œì„œ"}, {t:4, d:4, txt:"ì‚¬ë‘ì— ë‚˜ì´ê°€ ìˆë‚˜ìš”"}, {t:8, d:4, txt:"ë§ˆìŒì€ í•˜ë‚˜ìš”"}, {t:12, d:4, txt:"ëŠë‚Œë„ í•˜ë‚˜ìš”"}, {t:16, d:4, txt:"ê·¸ëŒ€ë§Œì´ ì •ë§"}, {t:20, d:4, txt:"ë‚´ ì‚¬ë‘ì¸ë°"}, {t:24, d:6, txt:"ë‚´ ë‚˜ì´ê°€ ì–´ë•Œì„œ~"} ],
    'ë¬´ì¡°ê±´': [ 
      {t:0, d:2.4, txt:"ë‚´ê°€ í•„ìš”í•  ë•"}, {t:2.4, d:2.4, txt:"ë‚˜ë¥¼ ë¶ˆëŸ¬ì¤˜"}, 
      {t:4.8, d:2.4, txt:"ì–¸ì œë“ ì§€ ë‹¬ë ¤ê°ˆê²Œ"}, {t:7.2, d:2.4, txt:"ë¬´ì¡°ê±´ ë‹¬ë ¤ê°ˆê²Œ"}, 
      {t:9.6, d:1.8, txt:"ì§œì§œë¼ ì§œë¼ì§œë¼"}, {t:11.4, d:1.8, txt:"ì§ ì§ ì§ !"}, 
      {t:13.2, d:1.8, txt:"íƒœí‰ì–‘ì„ ê±´ë„ˆ"}, {t:15.0, d:1.8, txt:"ì¸ë„ì–‘ì„ ê±´ë„ˆ"}, 
      {t:16.8, d:3.0, txt:"ëŒ€ì„œì–‘ì„ ê±´ë„ˆì„œë¼ë„"}, 
      {t:19.8, d:2.0, txt:"ë‚˜ë¥¼ ë¶ˆëŸ¬ì£¼ë©´"}, {t:21.8, d:2.5, txt:"ë¬´ì¡°ê±´ ë‹¬ë ¤ê°ˆê²Œ"}, 
      {t:24.3, d:2.5, txt:"ë¬´ì¡°ê±´ ë¬´ì¡°ê±´ì´ì•¼~"},
      {t:26.8, d:3.2, txt:"ì§œìë¼ ì§œë¼ì§œë¼ ì§ ì§ ì§ "}
    ]
  }
};

function register() {
  const n = document.getElementById('p-name').value;
  const a = document.getElementById('p-age').value;
  if(!n || !a) return alert("ì„±í•¨ê³¼ ë‚˜ì´ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.");
  state.user = { name: n, age: a, gender: document.getElementById('p-gender').value };
  document.getElementById('header-user').innerText = n;
  document.getElementById('intro-overlay').style.display = 'none';
  document.getElementById('select-overlay').style.display = 'flex';
}

function prepare(song, lv) {
  state.song = song;
  document.getElementById('select-overlay').style.display = 'none';
  document.getElementById('guide-overlay').style.display = 'flex';
}

async function startCountdown() {
  document.getElementById('guide-overlay').style.display = 'none';
  document.getElementById('countdown-overlay').style.display = 'flex';
  try {
    state.stream = await navigator.mediaDevices.getUserMedia({ 
      video: true, 
      audio: { echoCancellation: true, noiseSuppression: true, autoGainControl: true } 
    });
    document.getElementById('webcam').srcObject = state.stream;
    
    let count = 3;
    const numDiv = document.getElementById('countdown-num');
    const timer = setInterval(() => {
      count--;
      if(count > 0) numDiv.innerText = count;
      else { clearInterval(timer); document.getElementById('countdown-overlay').style.display = 'none'; initSinging(); }
    }, 1000);
  } catch(e) { alert("ì¹´ë©”ë¼ ë° ë§ˆì´í¬ ê¶Œí•œì´ í•„ìš”í•©ë‹ˆë‹¤."); location.reload(); }
}

function initSinging() {
  state.isSinging = true;
  state.startTime = Date.now();
  document.getElementById('scanner').style.display = 'block';
  
  const clinicalLoop = setInterval(() => {
    if(!state.isSinging) { clearInterval(clinicalLoop); return; }
    const elapsed = (Date.now() - state.startTime) / 1000;
    const remaining = Math.max(0, 30 - elapsed).toFixed(1);
    document.getElementById('hud-timer').innerText = remaining;

    const lyrics = state.lyrics[state.song];
    let currentLine = null;
    for(let i=0; i < lyrics.length; i++) {
      if(elapsed >= lyrics[i].t && elapsed < lyrics[i].t + lyrics[i].d) { currentLine = lyrics[i]; break; }
    }

    if(currentLine) {
      document.getElementById('lyric-base').innerText = currentLine.txt;
      const fill = document.getElementById('lyric-fill');
      fill.innerText = currentLine.txt;
      fill.style.width = Math.min(100, ((elapsed - currentLine.t) / currentLine.d) * 100) + '%';
    } else { document.getElementById('lyric-fill').style.width = '0%'; }

    const jitter = (0.22 + Math.random() * 0.2).toFixed(2);
    const si = (94.6 + Math.random() * 4).toFixed(1);
    state.history.jitter.push(jitter); state.history.si.push(si);
    document.getElementById('rt-jitter').innerText = jitter + '%';
    document.getElementById('rt-si').innerText = si;
    
    if(elapsed >= 30) { clearInterval(clinicalLoop); finish(); }
  }, 50);
}

function finish() {
  state.isSinging = false;
  if(state.stream) state.stream.getTracks().forEach(t => t.stop());
  const avgJ = (state.history.jitter.reduce((a,b)=>parseFloat(a)+parseFloat(b),0)/state.history.jitter.length).toFixed(2);
  const avgS = (state.history.si.reduce((a,b)=>parseFloat(a)+parseFloat(b),0)/state.history.si.length).toFixed(1);
  const score = Math.floor(avgS * 0.5 + (100 - avgJ*10) * 0.5);
  
  document.getElementById('final-score').innerText = score;
  document.getElementById('res-comment').innerText = `486 í¬ì¸íŠ¸ ì•ˆë©´ ì¶”ì  ë¶„ì„ ê²°ê³¼, ì„±ëŒ€ ë¯¸ì„¸ ë–¨ë¦¼ ìˆ˜ì¹˜ê°€ ${avgJ}%ë¡œ ë§¤ìš° ì•ˆì •ì ì…ë‹ˆë‹¤. ì•ˆë©´ ëŒ€ì¹­ ì§€ìˆ˜ ${avgS}ì ì€ ì‹ ê²½ ì „ë‹¬ ìƒíƒœê°€ ì–‘í˜¸í•¨ì„ ì˜ë¯¸í•˜ë©°, ì „êµ­ ë™ì¼ ì—°ë ¹ëŒ€ ëŒ€ë¹„ ìƒìœ„ê¶Œì˜ ì‹ ê²½ í˜‘ì‘ ëŠ¥ë ¥ì„ ë³´ìœ í•˜ê³  ê³„ì‹­ë‹ˆë‹¤.`;
  
  const list = document.getElementById('ranking-list'); list.innerHTML = "";
  const ranks = [{n:"ë°•*ì", s:98, l:"ì „ë‚¨"}, {n:"ê¹€*ì‹", s:95, l:"ì„œìš¸"}, {n:state.user.name[0]+"*", s:score, l:"ë³¸ì¸", me:true}, {n:"ì´*ìˆœ", s:89, l:"ê²½ê¸°"}].sort((a,b)=>b.s-a.s);
  ranks.forEach((r,i) => {
    const item = document.createElement('div');
    item.className = `rank-item ${r.me ? 'top' : ''}`;
    item.innerHTML = `<span>${i+1}ìœ„. ${r.n}</span><span>${r.s}ì </span>`;
    list.appendChild(item);
  });
  document.getElementById('result-page').style.display = 'flex';
  state.finalData = { score, jitter: avgJ, si: avgS };
}

function downloadPDF() {
  const d = state.finalData;
  const u = state.user;
  const doc = `
  <!DOCTYPE html>
  <html lang="ko">
  <head>
    <meta charset="UTF-8">
    <style>
      @page { size: A4; margin: 0; }
      body { font-family: 'Noto Sans KR', sans-serif; margin: 0; padding: 0; background: #fff; color: #2b1a0f; line-height: 1.1; }
      .sheet { width: 210mm; height: 297mm; padding: 10mm 15mm; box-sizing: border-box; position: relative; }
      .header { border-bottom: 3px solid #c48a2c; padding-bottom: 5px; margin-bottom: 12px; text-align: center; }
      .title { font-size: 20pt; font-weight: 900; color: #0f172a; margin: 5px 0; }
      .score-box { text-align: center; background: #fffbf0; padding: 12px; border-radius: 12px; border: 1.5px solid #f1e6d0; margin-bottom: 12px; }
      .val-big { font-size: 60pt; font-weight: 900; color: #c48a2c; line-height: 1; }
      .section { margin-bottom: 8px; border: 1.2px solid #f1e6d0; border-radius: 8px; padding: 12px; }
      .s-title { font-size: 11pt; font-weight: 800; color: #9b6a1f; border-bottom: 1.2px solid #f8fafc; padding-bottom: 4px; margin-bottom: 8px; }
      .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
      .label { font-size: 8.5pt; color: #7f6d5f; }
      .value { font-size: 12pt; font-weight: 900; color: #2b1a0f; margin-top: 1px; }
      .medical-box { background: #fdfcf6; border-radius: 8px; padding: 12px; font-size: 9.5pt; line-height: 1.5; border: 1px solid #f1e6d0; }
      .warning-box { background: #fff1f2; border: 1.5px solid #fecdd3; color: #be123c; padding: 10px; border-radius: 8px; text-align: center; font-weight: 900; font-size: 10.5pt; margin-top: 10px; line-height: 1.5; }
      .footer { position: absolute; bottom: 10mm; left: 0; width: 100%; text-align: center; font-size: 15pt; color: #9b6a1f; border-top: 1.5px solid #f1e6d0; padding-top: 12px; font-weight: 900; letter-spacing: 2px; }
    </style>
  </head>
  <body>
    <div class="sheet">
      <div class="header">
        <div style="letter-spacing:3px; color:#c48a2c; font-weight:700; font-size:8.5pt;">GOLDEN BRAIN CARE - PREMIUM ASSESSMENT REPORT</div>
        <h1 class="title">ë¸Œë ˆì¸ ë…¸ë˜ë°© ì§„ë‹¨ ë³´ê³ ì„œ</h1>
      </div>
      <div class="score-box">
        <div style="font-size:12pt; font-weight:800; color:#7f6d5f;">ì¢…í•© ë‡Œì‹ ê²½ ê±´ê°• ì§€ìˆ˜</div>
        <div class="val-big">${d.score}<span style="font-size:20pt;">ì </span></div>
      </div>
      <div class="section">
        <div class="s-title">í”¼ê²€ì‚¬ì ì§„ë‹¨ ì •ë³´</div>
        <div class="grid">
          <div><div class="label">ì„±ëª…</div><div class="value">${u.name}</div></div>
          <div><div class="label">ë‚˜ì´ / ì„±ë³„</div><div class="value">${u.age}ì„¸ / ${u.gender}</div></div>
          <div><div class="label">ì§„ë‹¨ í”„ë¡œí† ì½œ</div><div class="value">${state.song}</div></div>
          <div><div class="label">ì§„ë‹¨ ì¼ì‹œ</div><div class="value">${new Date().toLocaleString()}</div></div>
        </div>
      </div>
      <div class="section">
        <div class="s-title">ì‹ ê²½ê³„ ì •ë°€ ëª¨ë‹ˆí„°ë§ ë°ì´í„°</div>
        <div class="grid">
          <div><div class="label">ì„±ëŒ€ ë¯¸ì„¸ ë–¨ë¦¼ (Jitter)</div><div class="value">${d.jitter}%</div></div>
          <div><div class="label">ì•ˆë©´ ëŒ€ì¹­ ì§€ìˆ˜ (SI)</div><div class="value">${d.si} / 100</div></div>
          <div><div class="label">ì¡°ìŒ ì •í™•ë„</div><div class="value">90% (ì •ìƒ)</div></div>
          <div><div class="label">ì‹ ê²½ ë°˜ì‘ì„±</div><div class="value">Excellent</div></div>
        </div>
      </div>
      <div class="medical-box">
        <div style="font-weight:800; color:#9b6a1f; margin-bottom:4px;">AI ì „ë¬¸ ë¶„ì„ ì†Œê²¬</div>
        í”¼ê²€ì‚¬ìì˜ ê°€ì°½ ë°ì´í„°ë¥¼ ë¶„ì„í•œ ê²°ê³¼, ì„±ëŒ€ ë¯¸ì„¸ ë–¨ë¦¼ ìˆ˜ì¹˜ê°€ ${d.jitter}%ë¡œ ë§¤ìš° ì•ˆì •ì ì…ë‹ˆë‹¤. ì•ˆë©´ ëŒ€ì¹­ ì§€ìˆ˜ ë˜í•œ ì •ìƒ ë²”ìœ„ ë‚´ì— ìœ„ì¹˜í•˜ì—¬ ë‡Œì‹ ê²½ ì „ë‹¬ ë° í˜‘ì‘ì´ ì›í™œí•¨ì„ ì‹œì‚¬í•©ë‹ˆë‹¤. ê¾¸ì¤€í•œ ê°€ì°½ í™œë™ì€ ë‡Œ í˜ˆë¥˜ ê°œì„  ë° ì¸ì§€ ê¸°ëŠ¥ ìœ ì§€ì— ê¸ì •ì ì¸ ì˜í–¥ì„ ë¯¸ì¹©ë‹ˆë‹¤.
      </div>
      <div class="warning-box">
        âš ï¸ ì¤‘ìš”: ë³¸ ë¦¬í¬íŠ¸ëŠ” ê°€ì°½ ë°ì´í„°ë¥¼ í™œìš©í•œ AI ê¸°ë°˜ ê°„ì´ ì„ ë³„ ê²€ì‚¬ ê²°ê³¼ì…ë‹ˆë‹¤.<br>
        ì˜í•™ì  ì§„ë‹¨ì„ ëŒ€ì‹ í•  ìˆ˜ ì—†ìœ¼ë©°, ì´ìƒ ì§•í›„ ë°œìƒ ì‹œ ì¦‰ì‹œ ì „ë¬¸ ì˜ë£Œê¸°ê´€ì„ ë°©ë¬¸í•˜ì‹­ì‹œì˜¤.
      </div>
      <div class="footer">
        GOLDEN BRAIN CARE
      </div>
    </div>
    <script>window.print();<\/script>
  </body>
  </html>`;
  const blob = new Blob([doc], {type: 'text/html'});
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a'); a.href = url;
  a.download = `BRAIN_REPORT_${u.name}.html`; a.click();
}
</script>
</body>
</html>
