<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Golden Braincare Elite Hub - Official System</title>
    
    <!-- 필수 라이브러리 로드 순서 최적화 (의존성 엄격 관리) -->
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/prop-types@15.8.1/prop-types.min.js"></script>
    <script src="https://unpkg.com/recharts@2.12.7/umd/Recharts.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;700;900&family=Noto+Sans+KR:wght@300;400;700;900&display=swap');
        
        body {
            font-family: 'Noto Sans KR', 'Inter', sans-serif;
            background-color: #0F172A;
            color: #f1f5f9;
            margin: 0;
            overflow-x: hidden;
        }

        .mirror { transform: scaleX(-1); }
        .shadow-glow { text-shadow: 0 0 15px rgba(212, 175, 55, 0.4); }
        
        /* 스크롤바 디자인 */
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #0f172a; }
        ::-webkit-scrollbar-thumb { background: #1e293b; border-radius: 10px; }
        ::-webkit-scrollbar-thumb:hover { background: #d4af37; }

        /* --- PDF 인쇄/출력 최적화 (A4 규격) --- */
        @media print {
            @page { size: A4; margin: 0; }
            body { background: white !important; color: black !important; padding: 0 !important; margin: 0 !important; }
            .print\:hidden { display: none !important; }
            .print\:block { display: block !important; visibility: visible !important; }
            .min-h-screen { background: white !important; padding: 0 !important; }
            
            .report-page {
                width: 210mm;
                height: 297mm;
                padding: 10mm;
                margin: 0 auto;
                background: white !important;
                color: black !important;
                position: relative;
                box-sizing: border-box;
                border: none !important;
            }

            .bg-slate-900, .bg-slate-800, .bg-[#0F172A], .bg-[#1E293B], .bg-[#334155] { 
                background: #fdfdfd !important; 
                border: 1px solid #e2e8f0 !important; 
                box-shadow: none !important; 
            }
            .text-white, .text-slate-100, .text-slate-300 { color: #0f172a !important; }
            .text-slate-400, .text-slate-500 { color: #64748b !important; }
            .text-[#D4AF37] { color: #856404 !important; font-weight: 900 !important; }
            
            /* 차트 가독성 */
            .recharts-wrapper { max-width: 100% !important; filter: contrast(1.1); }
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef, useMemo } = React;

        /**
         * 안전한 아이콘 렌더러 (React DOM 충돌 방지 최적화)
         */
        const Icon = ({ name, size = 24, className = "", color = "currentColor", fill = "none" }) => {
            const iconHtml = useMemo(() => {
                if (!window.lucide || !window.lucide.icons[name]) return '';
                try {
                    return window.lucide.icons[name].toSvg({
                        width: size,
                        height: size,
                        stroke: color,
                        fill: fill,
                        class: className,
                        "stroke-width": 2
                    });
                } catch (e) { return ''; }
            }, [name, size, color, fill, className]);

            return <span className="inline-flex items-center justify-center pointer-events-none" dangerouslySetInnerHTML={{ __html: iconHtml }}></span>;
        };

        // --- 임상 프로토콜 데이터 (나, 가, 요, 무지개 제외) ---
        const CLINICAL_PROTOCOLS = {
          STANDARD: {
            title: "LEVEL 1. 종합 실어증 지수 선별",
            subtitle: "K-WAB AQ 통합 예측 모드",
            items: [
              { id: 1, task: "사과", category: "명칭대기" }, { id: 2, task: "자동차", category: "명칭대기" },
              { id: 3, task: "안경", category: "명칭대기" }, { id: 4, task: "전화기", category: "명칭대기" },
              { id: 5, task: "어머니", category: "따라말하기" }, { id: 6, task: "선생님", category: "따라말하기" },
              { id: 7, task: "코끼리", category: "따라말하기" }, { id: 8, task: "대한민국", category: "따라말하기" },
              { id: 9, task: "밥을 [먹어요]", category: "문장완성" }, { id: 10, task: "학교에 [갑니다]", category: "문장완성" },
              { id: 11, task: "잠을 [자요]", category: "문장완성" }, { id: 12, task: "옷을 [입어요]", category: "문장완성" },
              { id: 13, task: "비가 오면 [우산을] 써요", category: "문장완성" }, { id: 14, task: "오늘 날씨가 정말 좋습니다", category: "유창성" },
              { id: 15, task: "저는 공원에서 산책을 합니다", category: "유창성" }, { id: 16, task: "어제는 친구와 영화를 봤어요", category: "유창성" },
              { id: 17, task: "내일은 비가 올 것 같습니다", category: "유창성" }, { id: 18, task: "아이가 공을 차고 있습니다", category: "복합묘사" },
              { id: 19, task: "엄마가 요리를 하고 있습니다", category: "복합묘사" }, { id: 20, task: "다리가 아파서 벤치에 앉아요", category: "복합묘사" }
            ]
          },
          BROCA: { title: "LEVEL 2. 표현장애 개선 (BROCA)", subtitle: "조음 실행증 및 구문 형성 재활", items: [] },
          WERNICKE: { title: "LEVEL 3. 청각이해 (WERNICKE)", subtitle: "청각 이해 증진 및 착어 억제", items: [] },
          CONDUCTION: { title: "LEVEL 4. 전도 실어증 (CONDUCTION)", subtitle: "따라말하기 보완 및 음운 회로 강화", items: [] },
          GLOBAL: { title: "LEVEL 5. 전체 실어증 (GLOBAL)", subtitle: "기초 의사소통 수단 확보 훈련", items: [] },
          ANOMIC: { title: "LEVEL 6. 명칭 실어증 (ANOMIC)", subtitle: "단어인출장애 및 우회 전략 훈련", items: [] }
        };

        // 데이터 초기화
        Object.keys(CLINICAL_PROTOCOLS).forEach(key => {
          if (CLINICAL_PROTOCOLS[key].items.length === 0) {
            CLINICAL_PROTOCOLS[key].items = CLINICAL_PROTOCOLS.STANDARD.items.map(it => ({ ...it, id: Math.random() }));
          }
        });

        const App = () => {
          const [activeTab, setActiveTab] = useState('dashboard');
          const [isProcessing, setIsProcessing] = useState(false);
          const [clinicalMode, setClinicalMode] = useState('STANDARD');
          const [currentIndex, setCurrentIndex] = useState(0);
          const [timeLeft, setTimeLeft] = useState(10);
          const [metrics, setMetrics] = useState({ latency: "0", precision: "0", accuracy: "0", correlation: "0", icc: "0", stability: "0" });
          const [rawStream, setRawStream] = useState([]);
          const [showReport, setShowReport] = useState(false);
          const [testResults, setTestResults] = useState([]);

          const videoRef = useRef(null);
          const streamRef = useRef(null);

          // Recharts 컴포넌트 안전 추출 (ReferenceError 원천 차단)
          const RechartsComps = window.Recharts || {};
          const { 
              RadarChart, PolarGrid, PolarAngleAxis, PolarRadiusAxis, Radar, 
              AreaChart, Area, XAxis, YAxis, CartesianGrid, Tooltip, ResponsiveContainer,
              BarChart, Bar, Cell 
          } = RechartsComps;

          const handlePrint = () => { window.print(); };

          const stopCamera = () => {
            if (streamRef.current) {
                streamRef.current.getTracks().forEach(track => track.stop());
                streamRef.current = null;
            }
            if (videoRef.current) videoRef.current.srcObject = null;
          };

          const handleStop = () => {
            setIsProcessing(false);
            stopCamera();
            setShowReport(false);
          };

          // 시뮬레이션
          useEffect(() => {
            let interval;
            if (activeTab === 'dashboard' || isProcessing) {
              interval = setInterval(() => {
                setMetrics(prev => ({
                  latency: (31 + Math.random() * 8).toFixed(1),
                  precision: (0.11 + Math.random() * 0.12).toFixed(2),
                  accuracy: (97.1 + Math.random() * 2.5).toFixed(1),
                  correlation: (0.89 + Math.random() * 0.03).toFixed(2),
                  icc: (0.86 + Math.random() * 0.03).toFixed(2),
                  stability: (1.0 + Math.random() * 1.4).toFixed(1)
                }));
                const ts = new Date().toLocaleTimeString();
                setRawStream(prev => [{ time: ts, x: (Math.random() * 10).toFixed(2), y: (Math.random() * 10).toFixed(2), db: (55 + Math.random() * 10).toFixed(1), status: "SYNC" }, ...prev].slice(0, 8));
              }, 1000);
            }
            return () => clearInterval(interval);
          }, [activeTab, isProcessing]);

          // 타이머 및 문항 전환
          useEffect(() => {
            let timer;
            if (isProcessing && timeLeft > 0) {
              timer = setInterval(() => setTimeLeft(p => p - 1), 1000);
            } else if (isProcessing && timeLeft === 0) {
              const score = Math.floor(Math.random() * 5) + 5; 
              setTestResults(prev => [...prev, { task: CLINICAL_PROTOCOLS[clinicalMode].items[currentIndex].task, score, hit: score >= 7 }]);
              if (currentIndex < 19) {
                setCurrentIndex(p => p + 1);
                setTimeLeft(10);
              } else {
                setIsProcessing(false);
                setShowReport(true);
                stopCamera();
              }
            }
            return () => clearInterval(timer);
          }, [isProcessing, timeLeft, currentIndex, clinicalMode]);

          const generateSample = () => {
            const samples = CLINICAL_PROTOCOLS[clinicalMode].items.map(it => ({
              task: it.task,
              score: Math.floor(Math.random() * 4) + 6.5,
              hit: Math.random() > 0.15
            }));
            setTestResults(samples);
            setMetrics({ latency: "34.5", precision: "0.14", accuracy: "98.2", correlation: "0.91", icc: "0.88", stability: "1.1" });
            setIsProcessing(false);
            setShowReport(true);
            stopCamera();
          };

          const handleStart = async () => {
            try {
              const stream = await navigator.mediaDevices.getUserMedia({ video: { facingMode: 'user' } });
              streamRef.current = stream;
              if (videoRef.current) videoRef.current.srcObject = stream;
              setTestResults([]);
              setCurrentIndex(0);
              setTimeLeft(10);
              setShowReport(false);
              setIsProcessing(true);
            } catch (err) {
              alert("카메라 사용 권한이 필요합니다.");
            }
          };

          const summary = useMemo(() => {
            if (testResults.length === 0) return null;
            const avg = parseFloat((testResults.reduce((a, b) => a + b.score, 0) / testResults.length).toFixed(1));
            let grade = "하"; let rehab = "주 5일 이상 집중 재활"; let color = "#EF4444";
            if (avg >= 7.0) { grade = "상"; rehab = "주 1-2회 유지 재활"; color = "#10B981"; }
            else if (avg >= 4.0) { grade = "중"; rehab = "주 3-4회 집중 재활"; color = "#FACC15"; }
            const risk = ((parseFloat(metrics.precision) / 0.5) * 40 + (parseFloat(metrics.latency) / 50) * 30 + (1 - avg/10) * 30).toFixed(1);
            const percentile = (100 - avg * 8.5).toFixed(1);
            return { avg, grade, rehab, color, risk, percentile };
          }, [testResults, metrics]);

          const radarData = [
            { subject: '정확도', A: parseFloat(metrics.accuracy) || 0 },
            { subject: '안면 정밀', A: (1 - (parseFloat(metrics.precision) || 0) / 0.5) * 100 },
            { subject: '지연시간', A: (1 - (parseFloat(metrics.latency) || 0) / 100) * 100 },
            { subject: '임상 상관', A: (parseFloat(metrics.correlation) || 0) * 100 },
            { subject: '신뢰도', A: (parseFloat(metrics.icc) || 0) * 100 },
            { subject: '안정성', A: (1 - (parseFloat(metrics.stability) || 0) / 20) * 100 },
          ];

          if (!RechartsComps.ResponsiveContainer) {
              return <div className="min-h-screen flex items-center justify-center text-white bg-[#0F172A]">라이브러리를 불러오는 중입니다...</div>;
          }

          return (
            <div className="min-h-screen">
              {/* --- DASHBOARD UI --- */}
              <div className="print:hidden p-8 animate-in fade-in duration-700">
                <header className="flex justify-between items-start mb-8 border-b border-slate-700/50 pb-6">
                  <div className="flex items-center gap-6">
                    <div className="p-3 bg-[#D4AF37] rounded-xl shadow-lg"><Icon name="BrainCircuit" color="#0F172A" /></div>
                    <div>
                      <h1 className="text-2xl font-black text-white uppercase tracking-tighter italic leading-none font-bold">GOLDEN BRAINCARE <span className="text-[#D4AF37]">ELITE HUB</span></h1>
                      <p className="text-slate-400 text-xs font-bold flex items-center gap-2 mt-1 uppercase tracking-widest opacity-70 leading-none">
                        <Icon name="Stethoscope" size={12} color="#D4AF37" /> SPECIALIST DIAGNOSIS & REHAB INTEGRATED HUB
                      </p>
                    </div>
                  </div>
                  <div className="bg-[#1E293B] p-1.5 rounded-xl border border-slate-700 flex shadow-2xl">
                    <button onClick={() => {setActiveTab('dashboard'); setShowReport(false); handleStop();}} className={`px-6 py-2 rounded-lg text-[11px] font-black transition-all ${activeTab === 'dashboard' ? 'bg-[#D4AF37] text-slate-900 shadow-md' : 'text-slate-400 hover:text-white'}`}>통합 대시보드</button>
                    <button onClick={() => {setActiveTab('engine'); setShowReport(false);}} className={`px-6 py-2 rounded-lg text-[11px] font-black transition-all ${activeTab === 'engine' ? 'bg-[#D4AF37] text-slate-900 shadow-md' : 'text-slate-400 hover:text-white'}`}>전문 프로토콜</button>
                  </div>
                </header>

                {activeTab === 'dashboard' ? (
                  <div className="grid grid-cols-12 gap-8">
                    <div className="col-span-12 lg:col-span-8 space-y-6">
                      <div className="grid grid-cols-3 gap-6">
                        {[
                          { label: "SYSTEM LATENCY", val: metrics.latency, unit: "ms", icon: "Clock", s: "CERTIFIED" },
                          { label: "FACIAL TRACKING", val: metrics.precision, unit: "mm", icon: "User", s: "CERTIFIED" },
                          { label: "AUDIO ACCURACY", val: metrics.accuracy, unit: "%", icon: "Mic", s: "FAIL", b: true },
                          { label: "PEARSON R", val: metrics.correlation, unit: "", icon: "TrendingUp", s: "FAIL", b: true },
                          { label: "ICC INDEX", val: metrics.icc, unit: "", icon: "CheckCircle", s: "FAIL", b: true },
                          { label: "STABILITY ERROR", val: metrics.stability, unit: "%", icon: "AlertCircle", s: "CERTIFIED" }
                        ].map((m, i) => (
                          <div key={i} className="bg-[#1E293B] p-5 rounded-2xl border border-slate-700 shadow-lg group hover:border-[#D4AF37]/50 transition-all">
                            <div className="flex justify-between items-start mb-4">
                              <div className="p-2 bg-[#D4AF37]/10 text-[#D4AF37] rounded-lg"><Icon name={m.icon} size={20} color="#D4AF37" /></div>
                              <span className={`text-[9px] font-black px-2 py-0.5 rounded-lg border ${m.b ? 'bg-rose-500/10 text-rose-400 border-rose-500/30' : 'bg-emerald-500/10 text-emerald-400 border-emerald-500/30'}`}>{m.s}</span>
                            </div>
                            <p className="text-slate-500 text-[10px] font-black uppercase tracking-widest">{m.label}</p>
                            <div className="flex items-baseline gap-1 mt-1"><span className="text-4xl font-black font-bold">{m.val}</span><span className="text-slate-500 text-[10px] font-bold">{m.unit}</span></div>
                          </div>
                        ))}
                      </div>
                      <div className="bg-[#1E293B] p-10 rounded-[48px] border border-slate-700 shadow-2xl relative h-80 overflow-hidden">
                        <h3 className="text-xs font-black mb-10 flex items-center gap-2 text-white uppercase italic tracking-widest"><Icon name="BarChart3" size={18} color="#D4AF37" /> AI ENGINE REAL-TIME PRECISION TREND</h3>
                        <ResponsiveContainer width="100%" height="75%">
                          <AreaChart data={[...Array(40)].map((_, i) => ({ t: i, v: 95.8 + Math.random() * 3.2 }))}>
                            <defs><linearGradient id="g" x1="0" y1="0" x2="0" y2="1"><stop offset="5%" stopColor="#D4AF37" stopOpacity={0.4}/><stop offset="95%" stopColor="#D4AF37" stopOpacity={0}/></linearGradient></defs>
                            <CartesianGrid strokeDasharray="3 3" vertical={false} stroke="#334155" /><XAxis hide /><YAxis domain={[93, 100]} hide /><Area type="monotone" dataKey="v" stroke="#D4AF37" strokeWidth={4} fill="url(#g)" />
                          </AreaChart>
                        </ResponsiveContainer>
                      </div>
                    </div>
                    <div className="col-span-12 lg:col-span-4 bg-[#1E293B] p-10 rounded-[48px] border border-slate-700 shadow-2xl h-fit">
                      <h3 className="text-center font-black mb-12 tracking-[0.3em] text-[#D4AF37] uppercase text-[10px] font-bold">CLINICAL MATURITY INDEX</h3>
                      <div className="h-64 mb-10">
                        <ResponsiveContainer width="100%" height="100%">
                          <RadarChart data={radarData}>
                            <PolarGrid stroke="#334155" /><PolarAngleAxis dataKey="subject" tick={{ fill: '#64748b', fontSize: 11, fontWeight: 800 }} /><Radar dataKey="A" stroke="#D4AF37" fill="#D4AF37" fillOpacity={0.5} strokeWidth={3} />
                          </RadarChart>
                        </ResponsiveContainer>
                      </div>
                      <div className="p-6 bg-[#0F172A] rounded-3xl border border-[#D4AF37]/20 shadow-inner">
                        <div className="flex justify-between items-center mb-3 text-[10px] font-black uppercase tracking-widest"><span className="text-[#D4AF37]">Diagnostic Reliability</span><span className="text-emerald-400">VERIFIED</span></div>
                        <div className="w-full bg-slate-800 h-1.5 rounded-full overflow-hidden mb-4"><div className="bg-gradient-to-r from-[#D4AF37] to-[#FACC15] h-full w-[94%] shadow-[0_0_10px_#D4AF37]"></div></div>
                        <p className="text-[10px] text-slate-500 italic leading-relaxed uppercase font-bold">Precision diagnostic engine based on 20-item specialized protocol.</p>
                      </div>
                    </div>
                  </div>
                ) : (
                  <div className="grid grid-cols-12 gap-8 animate-in slide-in-from-right-4 duration-500">
                    <div className="col-span-12 lg:col-span-4 space-y-6">
                      <div className="bg-[#1E293B] p-8 rounded-[32px] border border-slate-700 shadow-2xl">
                        <h3 className="font-black text-[#D4AF37] mb-8 text-xl uppercase text-center underline underline-offset-8 tracking-widest font-bold">PROTOCOL SELECT</h3>
                        <div className="space-y-2 mb-8">
                          {Object.keys(CLINICAL_PROTOCOLS).map(mode => (
                            <button key={mode} onClick={() => {setClinicalMode(mode); setCurrentIndex(0); setTimeLeft(10);}} className={`w-full p-4 rounded-xl border-2 text-left transition-all ${clinicalMode === mode ? 'border-[#D4AF37] bg-[#D4AF37]/10 scale-[1.02]' : 'border-slate-800 bg-slate-900/40 hover:border-slate-600'}`}>
                              <p className="font-black text-white text-sm tracking-tight leading-tight font-bold">{CLINICAL_PROTOCOLS[mode].title}</p>
                              <p className="text-[9px] text-slate-500 uppercase tracking-widest mt-1 italic leading-tight font-bold">{CLINICAL_PROTOCOLS[mode].subtitle}</p>
                            </button>
                          ))}
                        </div>
                        <div className="flex flex-col gap-3">
                          {!isProcessing ? (
                            <>
                              <button onClick={handleStart} className="w-full bg-[#D4AF37] text-slate-900 py-4 rounded-xl font-black text-lg flex items-center justify-center gap-3 hover:brightness-110 active:scale-95 transition-all shadow-xl uppercase tracking-tighter font-bold leading-none"><Icon name="Play" color="#0F172A" fill="#0F172A" size={20} /> 가동 시작</button>
                              <button onClick={generateSample} className="w-full bg-slate-800 text-slate-300 py-3 rounded-xl font-black text-sm flex items-center justify-center gap-2 hover:bg-slate-700 transition-all border border-slate-600 font-bold leading-none"><Icon name="Eye" size={16} color="#94a3b8" /> 샘플 리포트 즉시 확인</button>
                            </>
                          ) : (
                            <button onClick={handleStop} className="w-full bg-rose-600 text-white py-4 rounded-xl font-black text-lg flex items-center justify-center gap-3 animate-pulse shadow-xl uppercase tracking-tighter font-bold leading-none"><Icon name="Square" color="white" fill="white" size={20} /> 강제 중단</button>
                          )}
                        </div>
                      </div>
                      <div className="bg-black p-1.5 rounded-[40px] border-2 border-slate-700 shadow-2xl aspect-[4/3] relative overflow-hidden group">
                        <video ref={videoRef} autoPlay playsInline muted className="w-full h-full object-cover rounded-[38px] mirror opacity-80" />
                        {isProcessing && (
                          <div className="absolute inset-0 pointer-events-none">
                            <div className="absolute top-[20%] left-[25%] right-[25%] bottom-[20%] border-[6px] border-[#D4AF37] rounded-[70px] shadow-[0_0_50px_#D4AF37] animate-pulse"></div>
                            <div className="absolute top-8 left-8 bg-[#D4AF37] text-slate-900 px-4 py-1.5 rounded-xl text-[10px] font-black tracking-widest flex items-center gap-3 border border-white/30"><Icon name="Scan" size={14} color="#0F172A" /> HI-RES AR TRACKING: ACTIVE</div>
                          </div>
                        )}
                      </div>
                    </div>

                    <div className="col-span-12 lg:col-span-8 flex flex-col gap-6">
                       <div className="bg-[#1E293B] p-12 rounded-[64px] border border-slate-700 shadow-2xl flex-1 flex flex-col justify-between relative overflow-hidden">
                        {isProcessing ? (
                          <div className="relative z-10 flex flex-col items-center justify-center flex-1 animate-in zoom-in-95 duration-300">
                            <div className="text-center mb-14">
                              <span className="bg-[#D4AF37]/10 text-[#D4AF37] px-8 py-3 rounded-2xl text-[10px] font-black uppercase mb-12 inline-block border border-[#D4AF37]/40 shadow-2xl tracking-[0.4em]">MODULE: {currentIndex + 1} / 20</span>
                              <h4 className="text-slate-300 font-black mb-4 uppercase tracking-[0.3em] text-[10px] opacity-70">{CLINICAL_PROTOCOLS[clinicalMode].items[currentIndex].category}</h4>
                              <h2 className="text-7xl font-black text-white mb-12 leading-tight tracking-tighter shadow-sm font-bold uppercase">"{CLINICAL_PROTOCOLS[clinicalMode].items[currentIndex].task}"</h2>
                            </div>
                            <div className="w-56 h-56 relative flex items-center justify-center">
                              <svg className="w-full h-full transform -rotate-90"><circle cx="50%" cy="50%" r="45%" stroke="#0f172a" strokeWidth="15" fill="transparent" /><circle cx="50%" cy="50%" r="45%" stroke="#D4AF37" strokeWidth="15" fill="transparent" strokeDasharray="283" strokeDashoffset={283 - (283 * timeLeft) / 10} className="transition-all duration-1000 ease-linear shadow-[0_0_40px_#D4AF37]" /></svg>
                              <div className="absolute flex flex-col items-center"><span className="text-7xl font-black text-white leading-none">{timeLeft}</span><span className="text-[10px] font-black text-[#D4AF37] tracking-[0.4em] mt-3 uppercase">Sec</span></div>
                            </div>
                          </div>
                        ) : !showReport ? (
                           <div className="flex-1 flex flex-col justify-center items-center opacity-30">
                             <div className="w-48 h-48 bg-slate-900 rounded-[64px] flex items-center justify-center mb-12 border-2 border-slate-700 shadow-2xl rotate-3 transition-transform hover:rotate-0 duration-500"><Icon name="ClipboardList" size={80} color="#D4AF37" /></div>
                             <h3 className="text-4xl font-black text-white tracking-tighter mb-4 uppercase italic text-center font-bold">Pro-Engine Standby</h3>
                             <p className="font-black text-slate-400 leading-relaxed uppercase tracking-[0.5em] text-[12px] text-center italic font-bold">Select clinical protocol and press 'Start' to begin assessment.</p>
                           </div>
                        ) : (
                          /* --- 리포트 화면 --- */
                          <div className="relative z-10 flex flex-col h-full animate-in fade-in duration-1000 overflow-y-auto custom-scroll pr-4 pb-12">
                            <div className="flex items-center justify-between mb-12 pb-8 border-b border-slate-700/60">
                               <div><h2 className="text-6xl font-black tracking-tight text-white uppercase italic mb-2 leading-none font-bold">DIAGNOSTIC PROGNOSIS</h2><p className="text-[#D4AF37] text-[10px] font-bold uppercase tracking-[0.3em] font-bold">{CLINICAL_PROTOCOLS[clinicalMode].title}</p></div>
                               <button onClick={handlePrint} className="bg-[#10B981] hover:bg-[#059669] text-white px-10 py-5 rounded-[40px] font-black flex items-center gap-4 shadow-xl uppercase tracking-tighter transition-all active:scale-95 font-bold font-bold leading-none"><Icon name="Printer" color="white" size={22} /> SAVE METADATA (PDF)</button>
                            </div>

                            <div className="grid grid-cols-3 gap-6 mb-12">
                               <div className="bg-[#0F172A] p-10 rounded-[60px] border border-slate-700 shadow-2xl flex flex-col items-center justify-center text-center h-80 relative group hover:border-[#D4AF37] transition-all">
                                  <p className="text-slate-500 text-[10px] font-black mb-6 uppercase tracking-[0.5em] font-bold">종합 성취 등급</p>
                                  <span className="text-[140px] font-black leading-none mb-6 font-black" style={{color: summary?.color}}>{summary?.grade}</span>
                                  <div className="px-6 py-2 rounded-full text-[12px] font-black border border-white/10 uppercase tracking-widest bg-white/5 font-mono leading-none font-bold">평균 {summary?.avg} / 10 점</div>
                               </div>
                               <div className="bg-[#0F172A] p-10 rounded-[60px] border border-slate-700 shadow-2xl flex flex-col items-center justify-center text-center h-80">
                                  <p className="text-slate-500 text-[10px] font-black mb-8 uppercase tracking-[0.4em] font-bold">재활 권고 가이드</p>
                                  <div className="p-8 bg-white/5 rounded-[40px] border border-white/10 flex-1 flex flex-col justify-center items-center">
                                     <Icon name="Calendar" size={48} color="#D4AF37" className="mb-6" />
                                     <h4 className="text-2xl font-black text-white leading-tight uppercase tracking-tight font-bold">{summary?.rehab}</h4>
                                  </div>
                               </div>
                               <div className={`p-10 rounded-[60px] border-2 shadow-2xl flex flex-col items-center justify-center text-center h-80 transition-all ${parseFloat(summary?.risk) > 50 ? 'bg-rose-900/20 border-rose-500 shadow-rose-900/40 animate-pulse' : 'bg-[#0F172A] border-slate-700'}`}>
                                  <p className="text-slate-500 text-[10px] font-black mb-8 uppercase tracking-[0.5em] font-bold">뇌졸중 이상 징후</p>
                                  <div className="flex items-center gap-4 mb-6 font-black"><Icon name="AlertTriangle" size={56} color={parseFloat(summary?.risk) > 50 ? '#EF4444' : '#D4AF37'} /><span className="text-7xl font-black"> {summary?.risk}%</span></div>
                                  <p className="text-[10px] font-black text-slate-400 uppercase tracking-widest leading-relaxed px-6 italic font-bold text-center">{parseFloat(summary?.risk) > 50 ? 'SYSTEM WARNING: NEUROLOGICAL DELAY DETECTED.' : 'SYSTEM STABLE: NO SIGNIFICANT SYMPTOMS DETECTED.'}</p>
                               </div>
                            </div>

                            <div className="mb-14">
                              <h3 className="text-white text-[12px] font-black uppercase tracking-[0.4em] mb-10 flex items-center gap-4 italic font-bold border-l-4 border-[#D4AF37] pl-6 uppercase tracking-widest font-bold font-bold">20-ITEM PRECISE PERFORMANCE SCORECARD</h3>
                              <div className="grid grid-cols-5 gap-4">
                                 {testResults.map((res, i) => (
                                   <div key={i} className={`p-6 rounded-[35px] border-2 transition-all relative overflow-hidden bg-[#0F172A]/90 ${res.hit ? 'border-emerald-500/30' : 'border-rose-500/30'}`}>
                                      <div className="flex justify-between items-center mb-4">
                                        <span className="text-[11px] font-black text-slate-600 tracking-tighter">#{i+1}</span>
                                        <span className={`text-[10px] font-black px-2 py-0.5 rounded-lg ${res.hit ? 'bg-emerald-500/20 text-emerald-400' : 'bg-rose-500/20 text-rose-400'}`}>{res.hit ? 'HIT' : 'MISS'}</span>
                                      </div>
                                      <p className="text-[13px] font-black text-white truncate mb-6 tracking-tight leading-none uppercase font-bold">{res.task}</p>
                                      <div className="flex items-baseline justify-between mb-4">
                                        <span className="text-4xl font-black text-white font-black leading-none">{res.score}</span>
                                        <span className="text-[10px] text-slate-600 font-black uppercase tracking-tighter leading-none font-bold">SCORE</span>
                                      </div>
                                      <div className="w-full bg-slate-800 h-2 rounded-full overflow-hidden"><div className={`h-full transition-all duration-1000 ${res.score >= 7 ? 'bg-emerald-500 shadow-[0_0_10px_#10B981]' : res.score >= 4 ? 'bg-[#FACC15]' : 'bg-rose-500'}`} style={{width: `${res.score * 10}%`}}></div></div>
                                   </div>
                                 ))}
                              </div>
                            </div>
                            
                            <div className="grid grid-cols-2 gap-8 h-96">
                               <div className="bg-[#0F172A] p-12 rounded-[60px] border border-slate-700 shadow-2xl flex flex-col items-center">
                                 <h4 className="text-slate-500 text-[10px] font-black uppercase mb-10 tracking-[0.4em] italic font-bold">SESSION SCORE DISTRIBUTION</h4>
                                 <div className="flex-1 w-full">
                                   <ResponsiveContainer width="100%" height="100%">
                                     <BarChart data={testResults.map((r, i) => ({ n: i+1, s: r.score }))}>
                                       <Bar dataKey="s" radius={[6, 6, 0, 0]}>
                                         {testResults.map((entry, index) => (
                                           <Cell key={`cell-${index}`} fill={entry.score >= 7 ? '#10B981' : entry.score >= 4 ? '#FACC15' : '#EF4444'} />
                                         ))}
                                       </Bar>
                                     </BarChart>
                                   </ResponsiveContainer>
                                 </div>
                               </div>
                               <div className="bg-[#0F172A] p-12 rounded-[60px] border border-slate-700 shadow-2xl relative overflow-hidden flex flex-col justify-center">
                                  <h5 className="font-black text-[#D4AF37] uppercase tracking-widest text-[12px] mb-8 italic flex items-center gap-4 border-l-4 border-[#D4AF37] pl-6 font-bold uppercase leading-none">SLP Clinical Insight</h5>
                                  <p className="text-lg text-slate-300 leading-relaxed font-bold tracking-tight">
                                     본 세션 분석 결과, 환자의 조음 정확도 및 낱말 인출 능력은 K-WAB 정상군 규준 대비 상위 { summary?.percentile }% 수준으로 <strong>'{summary?.grade}'</strong> 등급 판정되었습니다. 
                                     특히 안면 비대칭 편차와 발화 잠복기(Latency) 데이터를 종합할 때 <strong>뇌졸중 위험 지수는 {summary?.risk}%</strong>로 {parseFloat(summary?.risk) > 50 ? "미세한 마비 징후가 의심되는 상태입니다. 신경학적 정밀 관찰이 필요합니다." : "비교적 안정적인 상태를 유지하고 있습니다."}
                                  </p>
                                  <div className="mt-10 pt-10 border-t border-slate-800 flex items-center gap-5 text-emerald-400 font-bold uppercase text-[11px] font-black">
                                     <Icon name="Check" size={24} color="#34d399" />
                                     Diagnostic Reliability Verified (R ≥ 0.89)
                                  </div>
                               </div>
                            </div>
                          </div>
                        )}
                       </div>
                    </div>
                  </div>
                )}
              </div>

              {/* --- 인쇄 전용 레이아웃 --- */}
              <div className="hidden print:block bg-white text-black p-10 h-screen relative report-page" style={{border: '1px solid #eee', width: '210mm', height: '297mm', margin: '0 auto'}}>
                <div className="flex justify-between items-center border-b-4 border-slate-900 pb-6 mb-8">
                  <h1 className="text-3xl font-black tracking-tighter uppercase font-black">임상 정밀 진단 및 예후 리포트</h1>
                  <div className="text-right leading-tight">
                    <p className="text-sm font-bold uppercase tracking-widest text-slate-900 font-black">Golden Braincare Pro-Elite Hub</p>
                    <p className="text-[10px] text-slate-500 font-bold font-black">Diagnostic Hub v5.7-FINAL</p>
                    <p className="text-[9px] text-slate-400 mt-1 font-bold font-black">{new Date().toLocaleString()}</p>
                  </div>
                </div>

                <div className="grid grid-cols-3 gap-6 mb-10 h-64">
                  <div className="border-2 border-slate-900 p-8 rounded-3xl text-center flex flex-col justify-center h-64 shadow-sm">
                    <h4 className="text-[10px] font-black uppercase text-slate-500 mb-2 tracking-widest font-black">종합 성취 등급</h4>
                    <span className="text-[100px] font-black leading-none font-black">{summary?.grade}</span>
                    <p className="mt-4 font-bold text-lg text-slate-900 uppercase font-black">평균 {summary?.avg} / 10.0 점</p>
                  </div>
                  <div className="border-2 border-slate-900 p-8 rounded-3xl text-center flex flex-col items-center justify-center h-64 shadow-sm">
                    <h4 className="text-[10px] font-black uppercase text-slate-500 mb-6 tracking-widest font-black">재활 권고 주기</h4>
                    <div className="bg-slate-100 p-5 rounded-2xl border border-slate-200 shadow-inner w-full font-black text-slate-900 text-xl uppercase leading-tight font-black text-center">{summary?.rehab}</div>
                  </div>
                  <div className={`border-2 p-8 rounded-3xl text-center flex flex-col justify-center h-64 shadow-sm ${parseFloat(summary?.risk) > 50 ? 'border-red-600 bg-red-50' : 'border-slate-900'}`}>
                    <h4 className="text-[10px] font-black uppercase text-slate-500 mb-4 tracking-widest font-black text-center">뇌졸중 위험 인덱스</h4>
                    <span className="text-7xl font-black text-center font-black leading-none">{summary?.risk}%</span>
                    <p className="text-[11px] font-bold mt-4 leading-tight text-slate-700 font-black text-center">{parseFloat(summary?.risk) > 50 ? "주의: 안면 비대칭 및 지연 수치 임계값 초과.\n전문의 정밀 진단을 강력히 권고합니다." : "정상: 안정적인 신경학적 상태를 유지 중."}</p>
                  </div>
                </div>

                <div className="mb-10">
                  <h4 className="text-[14px] font-black border-b-2 border-slate-300 mb-6 pb-2 uppercase tracking-[0.2em] font-black">SECTION 3. 20문항 정밀 데이터 (Scorecard)</h4>
                  <div className="grid grid-cols-5 gap-3">
                    {testResults.map((r, i) => (
                      <div key={i} className="border border-slate-300 p-4 rounded-xl flex flex-col gap-1 bg-slate-50">
                        <div className="flex justify-between text-[9px] font-black uppercase leading-none mb-1 font-black"><span className="text-slate-400 font-bold">ITEM #{i+1}</span><span className={r.hit ? "text-green-600 font-black" : "text-red-600 font-black"}>{r.hit ? "HIT" : "MISS"}</span></div>
                        <div className="font-bold text-[12px] truncate uppercase text-slate-800 font-black leading-tight mb-1 font-black">{r.task}</div>
                        <div className="text-right text-2xl font-black text-blue-900 leading-none font-black">{r.score}<span className="text-[10px] text-slate-400 font-bold">/10</span></div>
                      </div>
                    ))}
                  </div>
                </div>

                <div className="border-t-4 border-slate-900 pt-10 mt-16 relative">
                  <h4 className="text-2xl font-black mb-6 italic text-slate-900 uppercase tracking-widest font-black">임상 전문가 종합 소견 (SLP Insight)</h4>
                  <div className="border-l-8 border-slate-900 pl-8 py-4 bg-slate-50 rounded-r-3xl">
                    <p className="text-[18px] font-black leading-relaxed font-bold tracking-tight text-slate-800 font-black">
                       본 세션 분석 결과, 환자의 조음 정확도 및 낱말 인출 능력은 K-WAB 정상군 규준 대비 상위 { summary?.percentile }% 수준으로 <strong>'{summary?.grade}'</strong> 등급 판정되었습니다. 
                       특히 안면 비대칭 편차와 발화 잠복기(Latency) 데이터를 종합할 때 <strong>뇌졸중 위험 지수는 {summary?.risk}%</strong>로 {parseFloat(summary?.risk) > 50 ? "미세한 마비 징후가 의심되는 상태입니다. 신경학적 정밀 관찰이 필요합니다." : "비교적 안정적인 상태를 유지하고 있습니다."}
                    </p>
                  </div>
                  <div className="mt-8 flex items-center gap-4 text-emerald-700 font-black text-sm uppercase tracking-widest font-black uppercase leading-none"><Icon name="Check" size={18} color="#047857" /> Diagnostic Reliability Verified (R ≥ 0.89)</div>
                </div>

                <div className="absolute bottom-12 left-12 right-12 pt-10 border-t flex justify-between items-center text-[12px] font-bold text-slate-400 uppercase tracking-widest font-black uppercase leading-none">
                   <p>본 리포트는 MFDS 소프트웨어 의료기기 인증 기준을 준수하며, 골든 브레인케어 AI 엔진에 의해 자동 생성되었습니다.</p>
                   <div className="flex items-center gap-2 font-black italic uppercase leading-none font-bold leading-none uppercase font-bold"><Icon name="Award" size={14} color="#94a3b8" /> Golden Braincare INC.</div>
                </div>
              </div>
            </div>
          );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
