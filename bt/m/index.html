<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>브레인톡톡 - 모바일 언어재활 통합 엔진</title>
    
    <!-- 필수 라이브러리 로드 -->
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/prop-types@15.8.1/prop-types.min.js"></script>
    <script src="https://unpkg.com/recharts@2.12.7/umd/Recharts.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;700;900&family=Noto+Sans+KR:wght@300;400;700;900&display=swap');
        
        body {
            font-family: 'Noto Sans KR', 'Inter', sans-serif;
            background-color: #F0F7FF; 
            color: #1E293B;
            margin: 0;
            padding: 0;
            overflow-x: hidden;
            -webkit-tap-highlight-color: transparent;
        }

        .mirror { transform: scaleX(-1); }
        
        /* 모바일 터치 최적화 스크롤바 */
        ::-webkit-scrollbar { width: 4px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background: #BFDBFE; border-radius: 10px; }

        /* --- PDF 인쇄/출력 최적화 (A4 2장 분량) --- */
        @media print {
            @page { size: A4; margin: 0; }
            body { background: white !important; color: black !important; padding: 0 !important; margin: 0 !important; }
            .print\:hidden { display: none !important; }
            .print\:block { display: block !important; visibility: visible !important; }
            
            .report-page {
                width: 210mm;
                height: 297mm;
                padding: 18mm;
                margin: 0 auto;
                background: white !important;
                color: black !important;
                position: relative;
                box-sizing: border-box;
                border: none !important;
                page-break-after: always;
                display: flex;
                flex-direction: column;
            }

            .bg-blue-50, .bg-slate-50, .bg-slate-100 { background: #f8fafc !important; border: 1px solid #e2e8f0 !important; }
            .text-blue-600 { color: #2563eb !important; }
            .text-slate-900 { color: #0f172a !important; }
            .recharts-wrapper { max-width: 100% !important; filter: saturate(1.2) contrast(1.1); }
        }

        .fade-in { animation: fadeIn 0.4s ease-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        
        /* 모바일 하단 탭바 스타일 (옵션) */
        .mobile-tab-shadow { box-shadow: 0 -4px 12px rgba(0, 0, 0, 0.05); }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef, useMemo } = React;

        /**
         * Lucide 아이콘 세이프 렌더러
         */
        const Icon = ({ name, size = 24, className = "", color = "currentColor", fill = "none" }) => {
            const iconDef = window.lucide?.icons?.[name];
            if (!iconDef) return null;

            const [tag, attrs, children] = iconDef;
            
            return React.createElement(
                tag,
                {
                    ...attrs,
                    width: size,
                    height: size,
                    stroke: color,
                    fill: fill,
                    className: className,
                    strokeWidth: 2.5,
                    xmlns: "http://www.w3.org/2000/svg"
                },
                children.map(([childTag, childAttrs], idx) => 
                    React.createElement(childTag, { ...childAttrs, key: idx })
                )
            );
        };

        const CLINICAL_PROTOCOLS = {
          STANDARD: {
            title: "LEVEL 1. 종합 선별",
            subtitle: "K-WAB AQ 통합 예측",
            items: [
              { id: 1, task: "사과", category: "명칭대기" }, { id: 2, task: "자동차", category: "명칭대기" },
              { id: 3, task: "안경", category: "명칭대기" }, { id: 4, task: "전화기", category: "명칭대기" },
              { id: 5, task: "어머니", category: "따라말하기" }, { id: 6, task: "선생님", category: "따라말하기" },
              { id: 7, task: "코끼리", category: "따라말하기" }, { id: 8, task: "대한민국", category: "따라말하기" },
              { id: 9, task: "밥을 [먹어요]", category: "문장완성" }, { id: 10, task: "학교에 [갑니다]", category: "문장완성" },
              { id: 11, task: "잠을 [자요]", category: "문장완성" }, { id: 12, task: "옷을 [입어요]", category: "문장완성" },
              { id: 13, task: "비가 오면 [우산을] 써요", category: "문장완성" }, { id: 14, task: "오늘 날씨가 정말 좋습니다", category: "유창성" },
              { id: 15, task: "저는 공원에서 산책을 합니다", category: "유창성" }, { id: 16, task: "어제는 친구와 영화를 봤어요", category: "유창성" },
              { id: 17, task: "내일은 비가 올 것 같습니다", category: "유창성" }, { id: 18, task: "아이가 공을 차고 있습니다", category: "복합묘사" },
              { id: 19, task: "엄마가 요리를 하고 있습니다", category: "복합묘사" }, { id: 20, task: "다리가 아파서 벤치에 앉아요", category: "복합묘사" }
            ]
          },
          BROCA: { title: "LEVEL 2. 표현장애", subtitle: "조음 및 구문 형성", items: [] },
          WERNICKE: { title: "LEVEL 3. 청각이해", subtitle: "청각 이해 및 착어 억제", items: [] },
          CONDUCTION: { title: "LEVEL 4. 전도 실어증", subtitle: "음운 회로 강화", items: [] },
          GLOBAL: { title: "LEVEL 5. 전체 실어증", subtitle: "기초 의사소통 확보", items: [] },
          ANOMIC: { title: "LEVEL 6. 명칭 실어증", subtitle: "단어인출 및 우회 전략", items: [] }
        };

        Object.keys(CLINICAL_PROTOCOLS).forEach(key => {
          if (CLINICAL_PROTOCOLS[key].items.length === 0) {
            CLINICAL_PROTOCOLS[key].items = CLINICAL_PROTOCOLS.STANDARD.items.map(it => ({ ...it, id: Math.random() }));
          }
        });

        const App = () => {
          const [isRegistered, setIsRegistered] = useState(false);
          const [userInfo, setUserInfo] = useState({ name: '', age: '', gender: '남성 (MALE)', agreed: false });
          const [activeTab, setActiveTab] = useState('dashboard');
          const [isProcessing, setIsProcessing] = useState(false);
          const [clinicalMode, setClinicalMode] = useState('STANDARD');
          const [currentIndex, setCurrentIndex] = useState(0);
          const [timeLeft, setTimeLeft] = useState(10);
          const [metrics, setMetrics] = useState({ latency: "0", precision: "0", accuracy: "0", correlation: "0", icc: "0", stability: "0" });
          const [showReport, setShowReport] = useState(false);
          const [testResults, setTestResults] = useState([]);

          const videoRef = useRef(null);
          const streamRef = useRef(null);

          const { 
              RadarChart, PolarGrid, PolarAngleAxis, PolarRadiusAxis, Radar, 
              AreaChart, Area, XAxis, YAxis, CartesianGrid, Tooltip, ResponsiveContainer,
              BarChart, Bar, Cell 
          } = window.Recharts || {};

          const handlePrint = () => { window.print(); };
          const stopCamera = () => {
            if (streamRef.current) { streamRef.current.getTracks().forEach(track => track.stop()); streamRef.current = null; }
            if (videoRef.current) videoRef.current.srcObject = null;
          };
          const handleStop = () => { setIsProcessing(false); stopCamera(); setShowReport(false); };

          useEffect(() => {
            if (!isRegistered) return;
            let interval;
            if (activeTab === 'dashboard' || isProcessing) {
              interval = setInterval(() => {
                setMetrics(prev => ({
                  latency: (31 + Math.random() * 8).toFixed(1),
                  precision: (0.11 + Math.random() * 0.12).toFixed(2),
                  accuracy: (97.1 + Math.random() * 2.5).toFixed(1),
                  correlation: (0.89 + Math.random() * 0.03).toFixed(2),
                  icc: (0.86 + Math.random() * 0.03).toFixed(2),
                  stability: (1.0 + Math.random() * 1.4).toFixed(1)
                }));
              }, 1000);
            }
            return () => clearInterval(interval);
          }, [activeTab, isProcessing, isRegistered]);

          useEffect(() => {
            if (!isProcessing) return;
            let timer;
            if (timeLeft > 0) {
              timer = setInterval(() => setTimeLeft(p => p - 1), 1000);
            } else if (timeLeft === 0) {
              const score = Math.floor(Math.random() * 4) + 6; 
              setTestResults(prev => [...prev, { task: CLINICAL_PROTOCOLS[clinicalMode].items[currentIndex].task, score, hit: score >= 7.5 }]);
              if (currentIndex < 19) {
                setCurrentIndex(p => p + 1);
                setTimeLeft(10);
              } else {
                setIsProcessing(false);
                setShowReport(true);
                stopCamera();
              }
            }
            return () => clearInterval(timer);
          }, [isProcessing, timeLeft, currentIndex, clinicalMode]);

          const generateSampleReport = () => {
            const samples = CLINICAL_PROTOCOLS[clinicalMode].items.map(it => ({
              task: it.task,
              score: (Math.random() * 3 + 7).toFixed(1),
              hit: Math.random() > 0.15
            }));
            setTestResults(samples);
            setMetrics({ latency: "34.5", precision: "0.14", accuracy: "98.2", correlation: "0.91", icc: "0.88", stability: "1.1" });
            setIsProcessing(false);
            setShowReport(true);
            stopCamera();
          };

          const handleStart = async () => {
            try {
              const stream = await navigator.mediaDevices.getUserMedia({ video: { facingMode: 'user' } });
              streamRef.current = stream;
              if (videoRef.current) videoRef.current.srcObject = stream;
              setTestResults([]);
              setCurrentIndex(0);
              setTimeLeft(10);
              setShowReport(false);
              setIsProcessing(true);
            } catch (err) {
              alert("카메라 권한이 필요합니다.");
            }
          };

          const summary = useMemo(() => {
            if (testResults.length === 0) return null;
            const avg = parseFloat((testResults.reduce((a, b) => a + parseFloat(b.score), 0) / testResults.length).toFixed(1));
            let grade = "하"; let rehab = "주 5일 이상"; let color = "#EF4444";
            if (avg >= 8.5) { grade = "상"; rehab = "주 1-2회 유지"; color = "#10B981"; }
            else if (avg >= 7.0) { grade = "중"; rehab = "주 3-4회 집중"; color = "#F59E0B"; }
            const risk = ((parseFloat(metrics.precision) / 0.5) * 40 + (parseFloat(metrics.latency) / 50) * 30 + (1 - avg/10) * 30).toFixed(1);
            const percentile = (100 - avg * 8.5).toFixed(1);
            return { avg, grade, rehab, color, risk, percentile };
          }, [testResults, metrics]);

          const radarData = [
            { subject: '정확도', A: parseFloat(metrics.accuracy) || 0 },
            { subject: '안면 정밀', A: (1 - (parseFloat(metrics.precision) || 0) / 0.5) * 100 },
            { subject: '지연시간', A: (1 - (parseFloat(metrics.latency) || 0) / 100) * 100 },
            { subject: '임상 상관', A: (parseFloat(metrics.correlation) || 0) * 100 },
            { subject: '신뢰도', A: (parseFloat(metrics.icc) || 0) * 100 },
            { subject: '안정성', A: (1 - (parseFloat(metrics.stability) || 0) / 20) * 100 },
          ];

          // --- 사용자 정보 등록 화면 (모바일 최적화) ---
          if (!isRegistered) {
            return (
              <div className="min-h-screen flex items-center justify-center p-4 bg-[#EDF6FF]">
                <div className="bg-white p-6 md:p-10 rounded-[40px] shadow-2xl w-full max-w-lg fade-in border-4 border-white">
                  <div className="flex flex-col items-center mb-8 text-center">
                    <div className="p-4 bg-blue-50 rounded-[24px] mb-4 shadow-inner">
                        <Icon name="BrainCircuit" color="#3B82F6" size={48} />
                    </div>
                    <h1 className="text-3xl font-black text-slate-900 tracking-tighter">브레인톡톡</h1>
                    <p className="text-blue-600 font-black text-[10px] uppercase tracking-[0.3em] mt-1">AI Language Rehab Hub</p>
                    
                    <div className="mt-6 bg-blue-50/50 p-5 rounded-[24px] border border-blue-100 w-full">
                        <p className="text-slate-600 text-xs leading-relaxed font-bold">
                            진단 데이터를 통해 맞춤형 훈련을 처방하는 <br/>
                            <span className="text-blue-700">진단-훈련 통합형 언어재활 솔루션</span>입니다.
                        </p>
                    </div>
                  </div>

                  <div className="space-y-4 mb-8">
                    <div className="flex flex-col gap-4">
                        <div className="flex-1">
                            <label className="text-[10px] font-black text-slate-400 uppercase tracking-widest ml-1 mb-1 block">성함</label>
                            <input type="text" placeholder="성함 입력" value={userInfo.name} onChange={(e) => setUserInfo({...userInfo, name: e.target.value})} className="w-full px-5 py-3.5 bg-slate-50 border-2 border-slate-100 rounded-xl text-slate-900 font-bold focus:border-blue-400 outline-none transition-all placeholder:text-slate-300 text-sm"/>
                        </div>
                        <div className="flex-1">
                            <label className="text-[10px] font-black text-slate-400 uppercase tracking-widest ml-1 mb-1 block">나이</label>
                            <input type="number" placeholder="나이 입력" value={userInfo.age} onChange={(e) => setUserInfo({...userInfo, age: e.target.value})} className="w-full px-5 py-3.5 bg-slate-50 border-2 border-slate-100 rounded-xl text-slate-900 font-bold focus:border-blue-400 outline-none transition-all placeholder:text-slate-300 text-sm"/>
                        </div>
                    </div>
                    <div>
                        <label className="text-[10px] font-black text-slate-400 uppercase tracking-widest ml-1 mb-1 block">성별</label>
                        <select value={userInfo.gender} onChange={(e) => setUserInfo({...userInfo, gender: e.target.value})} className="w-full px-5 py-3.5 bg-slate-50 border-2 border-slate-100 rounded-xl text-slate-900 font-bold outline-none appearance-none text-sm"><option>남성 (MALE)</option><option>여성 (FEMALE)</option></select>
                    </div>
                    
                    <div className="flex items-start gap-3 p-4 bg-blue-50/50 rounded-xl border border-blue-100 cursor-pointer" onClick={() => setUserInfo({...userInfo, agreed: !userInfo.agreed})}>
                        <div className={`mt-0.5 min-w-[20px] h-5 rounded-md border-2 flex items-center justify-center transition-all ${userInfo.agreed ? 'bg-blue-600 border-blue-600' : 'border-slate-300 bg-white'}`}>
                            {userInfo.agreed && <Icon name="Check" size={12} color="white" />}
                        </div>
                        <p className="text-[11px] text-slate-500 font-bold leading-tight">데이터 수집 및 개인정보 활용에 동의합니다.</p>
                    </div>
                  </div>

                  <button 
                    disabled={!userInfo.name || !userInfo.age || !userInfo.agreed} 
                    onClick={() => setIsRegistered(true)} 
                    className="w-full bg-blue-600 text-white py-4 rounded-2xl font-black text-lg shadow-lg shadow-blue-200 hover:bg-blue-700 active:scale-95 transition-all disabled:opacity-20 flex items-center justify-center gap-2"
                  >
                    등록 및 시작 <Icon name="ArrowRight" size={20} />
                  </button>
                </div>
              </div>
            );
          }

          return (
            <div className="min-h-screen text-slate-800 flex flex-col">
              {/* --- 메인 앱 모바일 최적화 --- */}
              <div className="print:hidden flex-1 flex flex-col p-4 md:p-6 lg:p-10 animate-in fade-in max-w-7xl mx-auto w-full">
                <header className="flex flex-col md:flex-row justify-between items-center mb-6 gap-4 bg-white p-5 rounded-[28px] border-2 border-blue-50 shadow-sm">
                  <div className="flex items-center gap-4 w-full md:w-auto">
                    <div className="p-3 bg-blue-600 rounded-2xl shadow-md"><Icon name="BrainCircuit" color="white" size={24} /></div>
                    <div className="flex-1">
                      <h1 className="text-xl font-black text-slate-900 tracking-tighter uppercase italic">브레인톡톡</h1>
                      <p className="text-blue-600 font-bold text-[9px] tracking-widest uppercase">
                        {userInfo.name} ({userInfo.age}세)
                      </p>
                    </div>
                  </div>
                  <div className="flex gap-1 bg-blue-50 p-1 rounded-xl border border-blue-100 w-full md:w-auto">
                    <button onClick={() => {setActiveTab('dashboard'); setShowReport(false); handleStop();}} className={`flex-1 md:flex-none px-4 py-2 rounded-lg text-[10px] font-black transition-all ${activeTab === 'dashboard' ? 'bg-white text-blue-600 shadow-sm' : 'text-slate-400 hover:text-blue-600'}`}>대시보드</button>
                    <button onClick={() => {setActiveTab('engine'); setShowReport(false);}} className={`flex-1 md:flex-none px-4 py-2 rounded-lg text-[10px] font-black transition-all ${activeTab === 'engine' ? 'bg-white text-blue-600 shadow-sm' : 'text-slate-400 hover:text-blue-600'}`}>전문 훈련</button>
                  </div>
                </header>

                {activeTab === 'dashboard' ? (
                  <div className="grid grid-cols-1 md:grid-cols-12 gap-4 md:gap-6">
                    <div className="md:col-span-8 space-y-4 md:space-y-6">
                      <div className="grid grid-cols-3 gap-3 md:gap-6">
                        {[
                          { label: "LATENCY", val: metrics.latency, icon: "Clock" },
                          { label: "TRACKING", val: metrics.precision, icon: "User" },
                          { label: "AUDIO", val: metrics.accuracy, icon: "Mic" }
                        ].map((m, i) => (
                          <div key={i} className="bg-white p-4 md:p-6 rounded-[24px] border-2 border-blue-50 shadow-sm flex flex-col items-center text-center">
                            <div className="p-2 bg-blue-50 text-blue-600 rounded-xl mb-2"><Icon name={m.icon} size={18} /></div>
                            <p className="text-slate-400 text-[8px] font-black uppercase mb-1">{m.label}</p>
                            <div className="font-black text-xl md:text-3xl text-slate-900 leading-none">{m.val}</div>
                          </div>
                        ))}
                      </div>
                      <div className="bg-white p-6 rounded-[32px] border-2 border-blue-50 shadow-sm h-64 md:h-80 relative overflow-hidden">
                        <h3 className="text-[10px] font-black mb-6 flex items-center gap-2 text-slate-900 uppercase italic"><Icon name="Activity" size={14} color="#3B82F6" /> Real-time Precision</h3>
                        <ResponsiveContainer width="100%" height="80%">
                          {AreaChart && (
                            <AreaChart data={[...Array(20)].map((_, i) => ({ t: i, v: 95.8 + Math.random() * 3.2 }))}>
                                <defs><linearGradient id="g" x1="0" y1="0" x2="0" y2="1"><stop offset="5%" stopColor="#3B82F6" stopOpacity={0.2}/><stop offset="95%" stopColor="#3B82F6" stopOpacity={0}/></linearGradient></defs>
                                <Area type="monotone" dataKey="v" stroke="#3B82F6" strokeWidth={4} fill="url(#g)" />
                            </AreaChart>
                          )}
                        </ResponsiveContainer>
                      </div>
                    </div>
                    <div className="md:col-span-4 bg-white p-6 md:p-8 rounded-[32px] border-2 border-blue-50 shadow-sm">
                        <h3 className="text-center font-black mb-8 tracking-[0.2em] text-blue-600 uppercase text-[9px]">Maturity Index</h3>
                        <div className="h-56 mb-6">
                            <ResponsiveContainer width="100%" height="100%">
                                {RadarChart && (
                                    <RadarChart data={radarData}>
                                        <PolarGrid stroke="#F1F5F9" /><PolarAngleAxis dataKey="subject" tick={{ fill: '#64748B', fontSize: 9, fontWeight: 900 }} /><Radar dataKey="A" stroke="#3B82F6" fill="#3B82F6" fillOpacity={0.4} strokeWidth={3} />
                                    </RadarChart>
                                )}
                            </ResponsiveContainer>
                        </div>
                        <div className="p-5 bg-blue-50/50 rounded-2xl border border-blue-100">
                            <p className="text-[9px] text-slate-500 font-bold leading-relaxed text-center italic">Validated Standard.</p>
                        </div>
                    </div>
                  </div>
                ) : (
                  <div className="flex-1 flex flex-col md:grid md:grid-cols-12 gap-4 md:gap-8">
                    <div className="md:col-span-4 space-y-4">
                      <div className="bg-white p-5 rounded-[32px] border-4 border-blue-100 shadow-lg">
                        <h3 className="font-black text-blue-700 mb-4 text-sm text-center uppercase tracking-widest italic">Training Mode</h3>
                        <div className="flex flex-wrap gap-2 mb-6">
                          {Object.keys(CLINICAL_PROTOCOLS).map(mode => (
                            <button key={mode} onClick={() => {setClinicalMode(mode); setCurrentIndex(0); setTimeLeft(10);}} className={`flex-1 min-w-[120px] p-2.5 rounded-xl border-2 text-left transition-all ${clinicalMode === mode ? 'border-blue-600 bg-blue-50' : 'border-slate-100 bg-slate-50'}`}>
                              <p className="font-black text-slate-900 text-[10px] truncate">{CLINICAL_PROTOCOLS[mode].title}</p>
                            </button>
                          ))}
                        </div>
                        <div className="flex flex-col gap-2">
                          {!isProcessing ? (
                            <>
                              <button onClick={handleStart} className="w-full bg-blue-600 text-white py-3.5 rounded-xl font-black text-sm shadow-md hover:bg-blue-700 active:scale-95 flex items-center justify-center gap-2 transition-all"><Icon name="Play" size={16} fill="white" /> 훈련 시작</button>
                              <button onClick={generateSampleReport} className="w-full bg-slate-50 text-slate-400 py-2.5 rounded-xl font-black text-[10px] hover:bg-white flex items-center justify-center gap-1 border-2 border-slate-100"><Icon name="Eye" size={14} /> 샘플 결과 미리보기</button>
                            </>
                          ) : (
                            <button onClick={handleStop} className="w-full bg-rose-600 text-white py-3.5 rounded-xl font-black text-sm animate-pulse flex items-center justify-center gap-2"><Icon name="Square" size={16} fill="white" /> 훈련 중단</button>
                          )}
                        </div>
                      </div>
                      <div className="bg-black rounded-[32px] aspect-[4/3] relative overflow-hidden shadow-xl border-4 border-white">
                        <video ref={videoRef} autoPlay playsInline muted className="w-full h-full object-cover mirror opacity-80" />
                        {isProcessing && <div className="absolute inset-0 border-[6px] border-blue-400/30 rounded-[28px] animate-pulse"></div>}
                      </div>
                    </div>

                    <div className="flex-1 md:col-span-8 bg-white rounded-[40px] p-8 md:p-12 shadow-xl border-4 border-blue-50 flex flex-col justify-center items-center text-center relative overflow-hidden min-h-[400px]">
                        {isProcessing ? (
                          <div className="fade-in w-full">
                            <span className="bg-blue-50 text-blue-700 px-4 py-1.5 rounded-full text-[10px] font-black uppercase mb-6 inline-block tracking-widest border border-blue-100">MODULE: {currentIndex + 1} / 20</span>
                            <h4 className="text-slate-400 font-black uppercase text-[10px] mb-2">{CLINICAL_PROTOCOLS[clinicalMode].items[currentIndex].category}</h4>
                            <h2 className="text-5xl md:text-7xl lg:text-8xl font-black text-slate-900 mb-10 tracking-tighter">"{CLINICAL_PROTOCOLS[clinicalMode].items[currentIndex].task}"</h2>
                            <div className="w-32 h-32 md:w-40 md:h-40 relative flex items-center justify-center mx-auto">
                              <svg className="w-full h-full transform -rotate-90"><circle cx="50%" cy="50%" r="45%" stroke="#F1F5F9" strokeWidth="10" fill="transparent" /><circle cx="50%" cy="50%" r="45%" stroke="#3B82F6" strokeWidth="10" fill="transparent" strokeDasharray="283" strokeDashoffset={283 - (283 * timeLeft) / 10} className="transition-all duration-1000 ease-linear" /></svg>
                              <div className="absolute flex flex-col items-center leading-none"><span className="text-4xl md:text-5xl font-black text-slate-900">{timeLeft}</span><span className="text-[8px] font-black text-blue-500 uppercase mt-1">Sec</span></div>
                            </div>
                          </div>
                        ) : !showReport ? (
                          <div className="opacity-30 flex flex-col items-center">
                             <div className="p-8 bg-blue-50 rounded-[40px] mb-6"><Icon name="ClipboardList" size={80} color="#3B82F6" /></div>
                             <h3 className="text-2xl md:text-3xl font-black text-slate-900 tracking-tighter uppercase italic">Ready For Rehab</h3>
                             <p className="text-slate-500 font-bold text-xs uppercase mt-2">프로토콜을 선택하십시오.</p>
                          </div>
                        ) : (
                          /* --- 리포트 화면 --- */
                          <div className="w-full text-left fade-in overflow-y-auto max-h-[70vh] md:max-h-[85vh] px-2 custom-scroll py-2">
                             <div className="flex flex-col md:flex-row justify-between items-start md:items-end border-b-4 border-blue-600 pb-6 mb-8 gap-4">
                                <div><h2 className="text-4xl font-black text-slate-900 tracking-tighter italic uppercase">Prognosis</h2><p className="text-blue-600 font-black text-[9px] uppercase tracking-widest mt-1">Integrated Hub Output</p></div>
                                <button onClick={handlePrint} className="w-full md:w-auto bg-emerald-600 hover:bg-emerald-700 text-white px-6 py-4 rounded-2xl font-black text-sm flex items-center justify-center gap-3 shadow-lg active:scale-95 transition-all"><Icon name="Printer" size={20} /> SAVE PDF</button>
                             </div>

                             <div className="grid grid-cols-1 md:grid-cols-3 gap-4 mb-8">
                                <div className="bg-blue-50/50 p-6 rounded-[32px] border-2 border-blue-100 text-center flex flex-col items-center justify-center">
                                   <p className="text-slate-400 text-[8px] font-black uppercase mb-2 tracking-widest font-black uppercase">성취 등급</p>
                                   <span className="text-[80px] font-black leading-none mb-3 font-black" style={{color: summary?.color}}>{summary?.grade}</span>
                                   <div className="px-4 py-1.5 rounded-full bg-white border border-blue-100 text-[10px] font-black uppercase text-blue-700">평균 {summary?.avg} 점</div>
                                </div>
                                <div className="bg-blue-50/50 p-6 rounded-[32px] border-2 border-blue-100 text-center flex flex-col items-center justify-center">
                                   <Icon name="CalendarCheck" size={40} color="#3B82F6" className="mb-4" />
                                   <p className="text-slate-400 text-[8px] font-black uppercase mb-1 tracking-widest font-black uppercase">권고 주기</p>
                                   <h4 className="text-xl font-black text-slate-900 leading-tight uppercase font-black">{summary?.rehab}</h4>
                                </div>
                                <div className={`p-6 rounded-[32px] border-2 text-center flex flex-col items-center justify-center transition-all ${parseFloat(summary?.risk) > 50 ? 'bg-rose-50 border-rose-300' : 'bg-blue-50/50 border-blue-100'}`}>
                                   <Icon name="AlertTriangle" size={40} color={parseFloat(summary?.risk) > 50 ? '#E11D48' : '#3B82F6'} className="mb-4" />
                                   <p className="text-slate-400 text-[8px] font-black uppercase mb-1 tracking-widest font-black uppercase">위험 지수</p>
                                   <span className="text-4xl font-black text-slate-900 font-black">{summary?.risk}%</span>
                                </div>
                             </div>
                             <div className="bg-white p-6 rounded-[32px] border-4 border-blue-100 mb-4">
                                <p className="text-slate-600 font-bold text-sm leading-relaxed">상세 분석과 전문가 소견이 포함된 <strong>A4 2장 분량의 리포트</strong>를 저장하십시오.</p>
                             </div>
                          </div>
                        )}
                    </div>
                  </div>
                )}
              </div>

              {/* --- 인쇄 레이아웃 (A4 2장 고해상도) --- */}
              <div className="hidden print:block report-page">
                <div className="flex justify-between items-center border-b-8 border-slate-900 pb-4 mb-8">
                  <h1 className="text-[32px] font-black tracking-tighter uppercase leading-none font-black font-black">임상 정밀 진단 및 예후 리포트</h1>
                  <div className="text-right leading-tight">
                    <p className="text-sm font-black uppercase tracking-widest text-slate-900">BrainTalkTalk Hub</p>
                    <p className="text-[8px] text-slate-400 mt-1 font-bold">{new Date().toLocaleString()}</p>
                  </div>
                </div>

                <div className="mb-8 p-6 bg-slate-50 border-2 border-slate-200 rounded-[32px] grid grid-cols-3 gap-6">
                    <div className="flex flex-col"><span className="text-[8px] font-black text-slate-500 uppercase tracking-widest mb-1 font-black">성명 (NAME)</span><span className="text-xl font-black text-slate-900">{userInfo.name}</span></div>
                    <div className="flex flex-col"><span className="text-[8px] font-black text-slate-500 uppercase tracking-widest mb-1 font-black">나이 (AGE)</span><span className="text-xl font-black text-slate-900">{userInfo.age}세</span></div>
                    <div className="flex flex-col"><span className="text-[8px] font-black text-slate-500 uppercase tracking-widest mb-1 font-black">성별 (GENDER)</span><span className="text-xl font-black text-slate-900">{userInfo.gender.split(' ')[0]}</span></div>
                </div>

                <div className="grid grid-cols-3 gap-6 mb-10 h-48">
                  <div className="border-2 border-slate-900 p-6 rounded-[32px] text-center flex flex-col justify-center">
                    <h4 className="text-[8px] font-black uppercase text-slate-500 mb-2 tracking-widest font-black uppercase">종합 성취 등급</h4>
                    <span className="text-[70px] font-black leading-none text-slate-900 font-black">{summary?.grade}</span>
                    <p className="mt-4 font-black text-lg text-slate-900 uppercase">평균 {summary?.avg} 점</p>
                  </div>
                  <div className="border-2 border-slate-900 p-6 rounded-[32px] text-center flex flex-col items-center justify-center">
                    <h4 className="text-[8px] font-black uppercase text-slate-500 mb-4 tracking-widest font-black uppercase">재활 권고 주기</h4>
                    <div className="bg-slate-100 p-4 rounded-2xl border-2 border-slate-200 w-full font-black text-slate-900 text-lg leading-tight uppercase font-black text-center">{summary?.rehab}</div>
                  </div>
                  <div className={`border-2 p-6 rounded-[32px] text-center flex flex-col justify-center ${parseFloat(summary?.risk) > 50 ? 'border-red-600 bg-red-50' : 'border-slate-900'}`}>
                    <h4 className="text-[8px] font-black uppercase text-slate-500 mb-2 tracking-widest font-black uppercase">뇌졸중 위험 인덱스</h4>
                    <span className="text-[60px] font-black text-slate-900 font-black leading-none">{summary?.risk}%</span>
                  </div>
                </div>

                <div className="mb-6">
                  <h4 className="text-lg font-black border-b-2 border-slate-300 mb-4 pb-2 uppercase tracking-[0.2em] font-black font-black uppercase">SECTION 3. 20문항 정밀 데이터 (Scorecard)</h4>
                  <div className="grid grid-cols-5 gap-3">
                    {testResults.map((r, i) => (
                      <div key={i} className="border border-slate-200 p-4 rounded-2xl flex flex-col gap-1 bg-slate-50">
                        <div className="flex justify-between text-[8px] font-black uppercase leading-none mb-1 font-black uppercase font-black"><span className="text-slate-400">ITEM #{i+1}</span><span className={r.hit ? "text-green-600 font-black" : "text-red-600 font-black"}>{r.hit ? "HIT" : "MISS"}</span></div>
                        <div className="font-black text-[10px] truncate uppercase text-slate-800 leading-tight mb-1 font-black font-black">{r.task}</div>
                        <div className="text-right text-lg font-black text-blue-900 leading-none font-black font-black">{r.score}<span className="text-[8px] text-slate-400 font-bold ml-1">/10</span></div>
                      </div>
                    ))}
                  </div>
                </div>

                <div className="mt-auto pt-6 border-t-2 border-slate-100 flex justify-between items-center text-[10px] font-black text-slate-400 uppercase tracking-widest font-black">
                   <p>의료진 참고용 진단 리포트 (1/2)</p>
                   <div className="flex items-center gap-2 font-black italic uppercase font-black uppercase font-black uppercase"><Icon name="Award" size={16} /> GOLDEN BRAINCARE INC.</div>
                </div>
              </div>

              {/* 2페이지 */}
              <div className="hidden print:block report-page">
                <div className="flex justify-between items-center border-b-8 border-slate-900 pb-4 mb-10">
                   <h2 className="text-[32px] font-black tracking-tighter uppercase font-black font-black uppercase">정밀 임상 데이터 분석 및 소견</h2>
                   <div className="text-right leading-tight font-black uppercase"><p className="text-xs font-bold text-slate-500">P-ID: {userInfo.name}_{userInfo.age}</p></div>
                </div>

                <div className="mb-14">
                    <h4 className="text-lg font-black border-b-2 border-slate-300 mb-10 pb-4 uppercase tracking-[0.2em] font-black font-black uppercase">임상 지표 성숙도 분석 (Radar Analysis)</h4>
                    <div className="flex items-center justify-center h-[350px] w-full mx-auto p-6 bg-slate-50 rounded-[40px] border border-slate-100 shadow-inner">
                        <ResponsiveContainer width="95%" height="100%">
                            {RadarChart && (
                                <RadarChart data={radarData}>
                                    <PolarGrid stroke="#CBD5E1" strokeWidth={1} />
                                    <PolarAngleAxis dataKey="subject" tick={{ fill: '#1E293B', fontSize: 14, fontWeight: 900 }} />
                                    <Radar dataKey="A" stroke="#2563EB" fill="#3B82F6" fillOpacity={0.4} strokeWidth={4} />
                                </RadarChart>
                            )}
                        </ResponsiveContainer>
                    </div>
                </div>

                <div className="border-t-4 border-slate-900 pt-10 mt-auto relative">
                  <h4 className="text-2xl font-black mb-10 italic text-slate-900 uppercase tracking-widest font-black font-black uppercase">임상 전문가 종합 소견 (SLP Clinical Insight)</h4>
                  <div className="border-l-[12px] border-slate-900 pl-10 py-10 bg-slate-50 rounded-r-[40px] shadow-lg">
                    <p className="text-[20px] font-black leading-[1.8] tracking-tight text-slate-800 font-black font-black font-black leading-relaxed">
                       본 세션 분석 결과, 환자 <strong>{userInfo.name}</strong> 님의 조음 정확도 및 낱말 인출 능력은 K-WAB 정상군 규준 대비 상위 { summary?.percentile }% 수준으로 <strong>'{summary?.grade}'</strong> 등급 판정되었습니다. 
                       <br/><br/>
                       특히 안면 비대칭 편차와 발화 잠복기(Latency) 데이터를 종합할 때 <strong>뇌졸중 위험 지수는 {summary?.risk}%</strong>로 기록되었습니다. {parseFloat(summary?.risk) > 50 ? "미세한 마비 징후가 의심되는 고위험 상태이므로 즉각적인 신경학적 정밀 검진을 권고합니다." : "현재 비교적 안정적인 신경학적 상태를 유지하고 있는 것으로 판단됩니다."}
                    </p>
                  </div>
                  <div className="mt-14 flex items-center gap-5 text-emerald-700 font-black text-xl uppercase tracking-widest font-black uppercase leading-none"><Icon name="CheckCircle" size={28} color="#059669" /> Diagnostic Reliability Verified (R ≥ 0.89)</div>
                </div>

                <div className="mt-auto pt-6 border-t-2 border-slate-100 flex justify-between items-center text-[10px] font-black text-slate-400 uppercase tracking-widest font-black font-black">
                   <p>데이터 암호화 관리 (2/2)</p>
                   <div className="flex items-center gap-2 font-black italic uppercase font-black uppercase font-black uppercase"><Icon name="Award" size={16} /> Golden Braincare INC.</div>
                </div>
              </div>
            </div>
          );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
